(()=>{var ys=Object.create;var _t=Object.defineProperty,bs=Object.defineProperties,vs=Object.getOwnPropertyDescriptor,_s=Object.getOwnPropertyDescriptors,Ps=Object.getOwnPropertyNames,qo=Object.getOwnPropertySymbols,js=Object.getPrototypeOf,Wo=Object.prototype.hasOwnProperty,xs=Object.prototype.propertyIsEnumerable;var Br=(e,t,r)=>t in e?_t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,y=(e,t)=>{for(var r in t||(t={}))Wo.call(t,r)&&Br(e,r,t[r]);if(qo)for(var r of qo(t))xs.call(t,r)&&Br(e,r,t[r]);return e},R=(e,t)=>bs(e,_s(t)),Go=e=>_t(e,"__esModule",{value:!0});var Et=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Fr=(e,t)=>{Go(e);for(var r in t)_t(e,r,{get:t[r],enumerable:!0})},Is=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ps(t))!Wo.call(e,o)&&o!=="default"&&_t(e,o,{get:()=>t[o],enumerable:!(r=vs(t,o))||r.enumerable});return e},Rt=e=>Is(Go(_t(e!=null?ys(js(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var d=(e,t,r)=>(Br(e,typeof t!="symbol"?t+"":t,r),r);var Zn=Et((jb,Xn)=>{var Mu;Xn.exports=Mu=function(){function e(t,r,o,n){this.set(t,r,o,n)}return e.prototype.set=function(t,r,o,n){this._cx=3*t,this._bx=3*(o-t)-this._cx,this._ax=1-this._cx-this._bx,this._cy=3*r,this._by=3*(n-r)-this._cy,this._ay=1-this._cy-this._by},e.epsilon=1e-6,e.prototype._sampleCurveX=function(t){return((this._ax*t+this._bx)*t+this._cx)*t},e.prototype._sampleCurveY=function(t){return((this._ay*t+this._by)*t+this._cy)*t},e.prototype._sampleCurveDerivativeX=function(t){return(3*this._ax*t+2*this._bx)*t+this._cx},e.prototype._solveCurveX=function(t,r){var o,n,a,i,s,u;for(a=void 0,i=void 0,s=void 0,u=void 0,o=void 0,n=void 0,s=t,n=0;n<8;){if(u=this._sampleCurveX(s)-t,Math.abs(u)<r)return s;if(o=this._sampleCurveDerivativeX(s),Math.abs(o)<r)break;s=s-u/o,n++}if(a=0,i=1,s=t,s<a)return a;if(s>i)return i;for(;a<i;){if(u=this._sampleCurveX(s),Math.abs(u-t)<r)return s;t>u?a=s:i=s,s=(i-a)*.5+a}return s},e.prototype.solve=function(t,r){return this._sampleCurveY(this._solveCurveX(t,r))},e.prototype.solveSimple=function(t){return this._sampleCurveY(this._solveCurveX(t,1e-6))},e}()});var ua=Et((lv,pa)=>{var or,no;or=[];no=[];function Hu(e,t,r){var o,n,a,i,s,u,p,l;if(e===t)return 0;if(o=e.length,n=t.length,o===0)return n;if(n===0)return o;for(r&&(e=e.toLowerCase(),t=t.toLowerCase()),p=0;p<o;)no[p]=e.charCodeAt(p),or[p]=++p;for(l=0;l<n;)for(a=t.charCodeAt(l),i=s=l++,p=-1;++p<o;)u=a===no[p]?s:s+1,s=or[p],or[p]=i=s>i?u>i?i+1:u:u>s?s+1:u;return i}pa.exports=Hu});var da=Et((fv,fa)=>{var la=ua();function Ju(){var e,t,r,o,n,a=0,i=arguments[0],s=arguments[1],u=s.length,p=arguments[2];p&&(o=p.threshold,n=p.ignoreCase),o===void 0&&(o=0);for(var l=0;l<u;++l)n?t=la(i,s[l],!0):t=la(i,s[l]),t>i.length?e=1-t/s[l].length:e=1-t/i.length,e>a&&(a=e,r=s[l]);return a>=o?r:null}fa.exports=Ju});var To=Et((TI,Qi)=>{"use strict";Qi.exports=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var o,n,a;if(Array.isArray(t)){if(o=t.length,o!=r.length)return!1;for(n=o;n--!=0;)if(!e(t[n],r[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(a=Object.keys(t),o=a.length,o!==Object.keys(r).length)return!1;for(n=o;n--!=0;)if(!Object.prototype.hasOwnProperty.call(r,a[n]))return!1;for(n=o;n--!=0;){var i=a[n];if(!e(t[i],r[i]))return!1}return!0}return t!==t&&r!==r}});var Uo={};Fr(Uo,{getProject:()=>cs,onChange:()=>ms,types:()=>Ir,val:()=>hs});var zo={};Fr(zo,{getProject:()=>cs,onChange:()=>ms,types:()=>Ir,val:()=>hs});var Ts=Array.isArray,N=Ts;var Ss=typeof window=="object"&&window&&window.Object===Object&&window,Vt=Ss;var As=typeof self=="object"&&self&&self.Object===Object&&self,ws=Vt||As||Function("return this")(),V=ws;var Cs=V.Symbol,X=Cs;var Ko=Object.prototype,Os=Ko.hasOwnProperty,Ds=Ko.toString,Pt=X?X.toStringTag:void 0;function ks(e){var t=Os.call(e,Pt),r=e[Pt];try{e[Pt]=void 0;var o=!0}catch(a){}var n=Ds.call(e);return o&&(t?e[Pt]=r:delete e[Pt]),n}var Ho=ks;var Es=Object.prototype,Rs=Es.toString;function Vs(e){return Rs.call(e)}var Jo=Vs;var Ns="[object Null]",Ls="[object Undefined]",Yo=X?X.toStringTag:void 0;function Ms(e){return e==null?e===void 0?Ls:Ns:Yo&&Yo in Object(e)?Ho(e):Jo(e)}var q=Ms;function Bs(e){return e!=null&&typeof e=="object"}var W=Bs;var Fs="[object Symbol]";function $s(e){return typeof e=="symbol"||W(e)&&q(e)==Fs}var ge=$s;var zs=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Us=/^\w*$/;function qs(e,t){if(N(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||ge(e)?!0:Us.test(e)||!zs.test(e)||t!=null&&e in Object(t)}var Je=qs;function Ws(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Z=Ws;var Gs="[object AsyncFunction]",Ks="[object Function]",Hs="[object GeneratorFunction]",Js="[object Proxy]";function Ys(e){if(!Z(e))return!1;var t=q(e);return t==Ks||t==Hs||t==Gs||t==Js}var Nt=Ys;var Xs=V["__core-js_shared__"],Lt=Xs;var Xo=function(){var e=/[^.]+$/.exec(Lt&&Lt.keys&&Lt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Zs(e){return!!Xo&&Xo in e}var Zo=Zs;var Qs=Function.prototype,ep=Qs.toString;function tp(e){if(e!=null){try{return ep.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var ue=tp;var rp=/[\\^$.*+?()[\]{}|]/g,op=/^\[object .+?Constructor\]$/,np=Function.prototype,ap=Object.prototype,ip=np.toString,sp=ap.hasOwnProperty,pp=RegExp("^"+ip.call(sp).replace(rp,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function up(e){if(!Z(e)||Zo(e))return!1;var t=Nt(e)?pp:op;return t.test(ue(e))}var Qo=up;function lp(e,t){return e==null?void 0:e[t]}var en=lp;function fp(e,t){var r=en(e,t);return Qo(r)?r:void 0}var F=fp;var dp=F(Object,"create"),le=dp;function cp(){this.__data__=le?le(null):{},this.size=0}var tn=cp;function mp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var rn=mp;var hp="__lodash_hash_undefined__",gp=Object.prototype,yp=gp.hasOwnProperty;function bp(e){var t=this.__data__;if(le){var r=t[e];return r===hp?void 0:r}return yp.call(t,e)?t[e]:void 0}var on=bp;var vp=Object.prototype,_p=vp.hasOwnProperty;function Pp(e){var t=this.__data__;return le?t[e]!==void 0:_p.call(t,e)}var nn=Pp;var jp="__lodash_hash_undefined__";function xp(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=le&&t===void 0?jp:t,this}var an=xp;function Ye(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}Ye.prototype.clear=tn;Ye.prototype.delete=rn;Ye.prototype.get=on;Ye.prototype.has=nn;Ye.prototype.set=an;var $r=Ye;function Ip(){this.__data__=[],this.size=0}var sn=Ip;function Tp(e,t){return e===t||e!==e&&t!==t}var Xe=Tp;function Sp(e,t){for(var r=e.length;r--;)if(Xe(e[r][0],t))return r;return-1}var ye=Sp;var Ap=Array.prototype,wp=Ap.splice;function Cp(e){var t=this.__data__,r=ye(t,e);if(r<0)return!1;var o=t.length-1;return r==o?t.pop():wp.call(t,r,1),--this.size,!0}var pn=Cp;function Op(e){var t=this.__data__,r=ye(t,e);return r<0?void 0:t[r][1]}var un=Op;function Dp(e){return ye(this.__data__,e)>-1}var ln=Dp;function kp(e,t){var r=this.__data__,o=ye(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this}var fn=kp;function Ze(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}Ze.prototype.clear=sn;Ze.prototype.delete=pn;Ze.prototype.get=un;Ze.prototype.has=ln;Ze.prototype.set=fn;var be=Ze;var Ep=F(V,"Map"),ve=Ep;function Rp(){this.size=0,this.__data__={hash:new $r,map:new(ve||be),string:new $r}}var dn=Rp;function Vp(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var cn=Vp;function Np(e,t){var r=e.__data__;return cn(t)?r[typeof t=="string"?"string":"hash"]:r.map}var _e=Np;function Lp(e){var t=_e(this,e).delete(e);return this.size-=t?1:0,t}var mn=Lp;function Mp(e){return _e(this,e).get(e)}var hn=Mp;function Bp(e){return _e(this,e).has(e)}var gn=Bp;function Fp(e,t){var r=_e(this,e),o=r.size;return r.set(e,t),this.size+=r.size==o?0:1,this}var yn=Fp;function Qe(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}Qe.prototype.clear=dn;Qe.prototype.delete=mn;Qe.prototype.get=hn;Qe.prototype.has=gn;Qe.prototype.set=yn;var Ne=Qe;var $p="Expected a function";function zr(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError($p);var r=function(){var o=arguments,n=t?t.apply(this,o):o[0],a=r.cache;if(a.has(n))return a.get(n);var i=e.apply(this,o);return r.cache=a.set(n,i)||a,i};return r.cache=new(zr.Cache||Ne),r}zr.Cache=Ne;var bn=zr;var zp=500;function Up(e){var t=bn(e,function(o){return r.size===zp&&r.clear(),o}),r=t.cache;return t}var vn=Up;var qp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Wp=/\\(\\)?/g,Gp=vn(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(qp,function(r,o,n,a){t.push(n?a.replace(Wp,"$1"):o||r)}),t}),_n=Gp;function Kp(e,t){for(var r=-1,o=e==null?0:e.length,n=Array(o);++r<o;)n[r]=t(e[r],r,e);return n}var Pn=Kp;var Hp=1/0,jn=X?X.prototype:void 0,xn=jn?jn.toString:void 0;function In(e){if(typeof e=="string")return e;if(N(e))return Pn(e,In)+"";if(ge(e))return xn?xn.call(e):"";var t=e+"";return t=="0"&&1/e==-Hp?"-0":t}var Mt=In;function Jp(e){return e==null?"":Mt(e)}var Bt=Jp;function Yp(e,t){return N(e)?e:Je(e,t)?[e]:_n(Bt(e))}var et=Yp;var Xp=1/0;function Zp(e){if(typeof e=="string"||ge(e))return e;var t=e+"";return t=="0"&&1/e==-Xp?"-0":t}var re=Zp;function Qp(e,t){t=et(t,e);for(var r=0,o=t.length;e!=null&&r<o;)e=e[re(t[r++])];return r&&r==o?e:void 0}var Ft=Qp;function eu(e,t,r){var o=e==null?void 0:Ft(e,t);return o===void 0?r:o}var tt=eu;function tu(e,t){return function(r){return e(t(r))}}var $t=tu;var ru=$t(Object.getPrototypeOf,Object),Tn=ru;var ou="[object Object]",nu=Function.prototype,au=Object.prototype,Sn=nu.toString,iu=au.hasOwnProperty,su=Sn.call(Object);function pu(e){if(!W(e)||q(e)!=ou)return!1;var t=Tn(e);if(t===null)return!0;var r=iu.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Sn.call(r)==su}var jt=pu;function uu(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var An=uu;var zt=class{constructor(t){this._untapFromSourceTimeout=null;this._cb=t=>{for(let r of this._tappers.values())r(t)};this._lastTapperId=0,this._untapFromSource=null,this._props=t,this._tappers=new Map}_check(){this._untapFromSource?this._tappers.size===0&&this._scheduleToUntapFromSource():this._tappers.size!==0&&(this._untapFromSource=this._props.tapToSource(this._cb))}_scheduleToUntapFromSource(){this._untapFromSourceTimeout===null&&(this._untapFromSourceTimeout=setTimeout(()=>{this._untapFromSourceTimeout=null,this._tappers.size===0&&(this._untapFromSource(),this._untapFromSource=null)},0))}tap(t){let r=this._lastTapperId++;return this._tappers.set(r,t),this._check(),()=>{this._removeTapperById(r)}}_removeTapperById(t){this._tappers.delete(t),this._check()}};var Pe=class{constructor(){this._lastTapperId=0,this._tappers=new Map,this.tappable=new zt({tapToSource:t=>this._tap(t)})}_tap(t){var o;let r=this._lastTapperId++;return this._tappers.set(r,t),(o=this._onNumberOfTappersChangeListener)==null||o.call(this,this._tappers.size),()=>{this._removeTapperById(r)}}_removeTapperById(t){var n;let r=this._tappers.size;this._tappers.delete(t);let o=this._tappers.size;r!==o&&((n=this._onNumberOfTappersChangeListener)==null||n.call(this,o))}emit(t){for(let r of this._tappers.values())r(t)}hasTappers(){return this._tappers.size!==0}onNumberOfTappersChange(t){this._onNumberOfTappersChangeListener=t}};var Ut=class{constructor(t,r){this._possiblyMarkAsStale=()=>{this._ticker.onThisOrNextTick(this._refresh)};this._refresh=()=>{let t=this._derivation.getValue();t===this._lastValue&&this._lastValueRecorded===!0||(this._lastValue=t,this._lastValueRecorded=!0,this._emitter.emit(t))};return this._derivation=t,this._ticker=r,this._emitter=new Pe,this._emitter.onNumberOfTappersChange(()=>{this._reactToNumberOfTappersChange()}),this._hadTappers=!1,this._lastValueRecorded=!1,this._lastValue=void 0,this}_reactToNumberOfTappersChange(){let t=this._emitter.hasTappers();t!==this._hadTappers&&(this._hadTappers=t,t?this._derivation.addDependent(this._possiblyMarkAsStale):this._derivation.removeDependent(this._possiblyMarkAsStale))}tappable(){return this._emitter.tappable}};var qt=class{constructor(t,r=!1){this.dontEmitValues=r;this._possiblyMarkAsStale=()=>{this._emitter.emit(void 0)};return this._derivation=t,this._emitter=new Pe,this._emitter.onNumberOfTappersChange(()=>{this._reactToNumberOfTappersChange()}),this._hadTappers=!1,this}_reactToNumberOfTappersChange(){let t=this._emitter.hasTappers();t!==this._hadTappers&&(this._hadTappers=t,t?this._derivation.addDependent(this._possiblyMarkAsStale):this._derivation.removeDependent(this._possiblyMarkAsStale))}tappable(){return this._emitter.tappable}};function oe(e){return e&&e.isDerivation&&e.isDerivation===!0}var M;(function(o){o[o.none=0]="none",o[o.dep=1]="dep",o[o.inner=2]="inner"})(M||(M={}));var lu=()=>{class e extends G{constructor(r,o){super();this._depDerivation=r;this._fn=o;return this._innerDerivation=void 0,this._staleDependency=1,this._addDependency(r),this}_recalculateHot(){let r=this._staleDependency;if(this._staleDependency=0,r===2)return this._innerDerivation.getValue();let o=this._fn(this._depDerivation.getValue());return oe(o)?(this._innerDerivation=o,this._addDependency(o),o.getValue()):o}_recalculateCold(){let r=this._fn(this._depDerivation.getValue());return oe(r)?r.getValue():r}_recalculate(){return this.isHot?this._recalculateHot():this._recalculateCold()}_reactToDependencyBecomingStale(r){let o=r===this._depDerivation?1:2;if(o===2&&r!==this._innerDerivation)throw Error("got a _reactToDependencyBecomingStale() from neither the dep nor the inner derivation");this._staleDependency===0?(this._staleDependency=o,o===1&&this._removeInnerDerivation()):this._staleDependency===1||o===1&&(this._staleDependency=1,this._removeInnerDerivation())}_removeInnerDerivation(){this._innerDerivation&&(this._removeDependency(this._innerDerivation),this._innerDerivation=void 0)}_keepHot(){this._staleDependency=1,this.getValue()}_becomeCold(){this._staleDependency=1,this._removeInnerDerivation()}}return e.displayName="flatMap",e},Ur;function qr(e,t){return Ur||(Ur=lu()),new Ur(e,t)}var fu=()=>class extends G{constructor(t,r){super();this._dep=t;this._fn=r;this._addDependency(t)}_recalculate(){return this._fn(this._dep.getValue())}_reactToDependencyBecomingStale(){}},Wr;function Gr(e,t){return Wr||(Wr=fu()),new Wr(e,t)}var rt=class{constructor(){this._head=void 0}peek(){return this._head&&this._head.data}pop(){let t=this._head;if(!!t)return this._head=t.next,t.data}push(t){let r={next:this._head,data:t};this._head=r}};function wn(){let e=()=>{},t=new rt,r=e;return{type:"Dataverse_discoveryMechanism",startIgnoringDependencies:()=>{t.push(r)},stopIgnoringDependencies:()=>{t.peek()!==r||t.pop()},reportResolutionStart:p=>{let l=t.peek();l&&l(p),t.push(r)},reportResolutionEnd:p=>{t.pop()},pushCollector:p=>{t.push(p)},popCollector:p=>{if(t.peek()!==p)throw new Error("Popped collector is not on top of the stack");t.pop()}}}function du(){let e="__dataverse_discoveryMechanism_sharedStack",t=typeof window!="undefined"||typeof window!="undefined"?window:{};if(t){let r=t[e];if(r&&typeof r=="object"&&r.type==="Dataverse_discoveryMechanism")return r;{let o=wn();return t[e]=o,o}}else return wn()}var{startIgnoringDependencies:ot,stopIgnoringDependencies:nt,reportResolutionEnd:Cn,reportResolutionStart:On,pushCollector:Dn,popCollector:kn}=du();var G=class{constructor(){this.isDerivation=!0;this._didMarkDependentsAsStale=!1;this._isHot=!1;this._isFresh=!1;this._lastValue=void 0;this._dependents=new Set;this._dependencies=new Set;this._internal_markAsStale=t=>{if(this._reactToDependencyBecomingStale(t),!this._didMarkDependentsAsStale){this._didMarkDependentsAsStale=!0,this._isFresh=!1;for(let r of this._dependents)r(this)}}}get isHot(){return this._isHot}_addDependency(t){this._dependencies.has(t)||(this._dependencies.add(t),this._isHot&&t.addDependent(this._internal_markAsStale))}_removeDependency(t){!this._dependencies.has(t)||(this._dependencies.delete(t),this._isHot&&t.removeDependent(this._internal_markAsStale))}changes(t){return new Ut(this,t).tappable()}changesWithoutValues(){return new qt(this).tappable()}keepHot(){return this.changesWithoutValues().tap(()=>{})}tapImmediate(t,r){let o=this.changes(t).tap(r);return r(this.getValue()),o}addDependent(t){let r=this._dependents.size>0;this._dependents.add(t);let o=this._dependents.size>0;r!==o&&this._reactToNumberOfDependentsChange()}removeDependent(t){let r=this._dependents.size>0;this._dependents.delete(t);let o=this._dependents.size>0;r!==o&&this._reactToNumberOfDependentsChange()}_markAsStale(t){this._internal_markAsStale(t)}getValue(){if(On(this),!this._isFresh){let t=this._recalculate();this._lastValue=t,this._isHot&&(this._isFresh=!0,this._didMarkDependentsAsStale=!1)}return Cn(this),this._lastValue}_reactToNumberOfDependentsChange(){let t=this._dependents.size>0;if(t!==this._isHot)if(this._isHot=t,this._didMarkDependentsAsStale=!1,this._isFresh=!1,t){for(let r of this._dependencies)r.addDependent(this._internal_markAsStale);this._keepHot()}else{for(let r of this._dependencies)r.removeDependent(this._internal_markAsStale);this._becomeCold()}}_keepHot(){}_becomeCold(){}map(t){return Gr(this,t)}flatMap(t){return qr(this,t)}};var En=()=>{},Le=class extends G{constructor(t,r){super();this._tapToSource=t;this._getValueFromSource=r;this._untapFromChanges=En,this._cachedValue=void 0,this._hasCachedValue=!1}_recalculate(){return this.isHot?(this._hasCachedValue||(this._cachedValue=this._getValueFromSource(),this._hasCachedValue=!0),this._cachedValue):this._getValueFromSource()}_keepHot(){this._hasCachedValue=!1,this._cachedValue=void 0,this._untapFromChanges=this._tapToSource(t=>{this._hasCachedValue=!0,this._cachedValue=t,this._markAsStale(this)})}_becomeCold(){this._untapFromChanges(),this._untapFromChanges=En,this._hasCachedValue=!1,this._cachedValue=void 0}_reactToDependencyBecomingStale(){}};var Kr=new WeakMap,Rn=new WeakMap,Vn=Symbol("pointerMeta"),cu={get(e,t){if(t===Vn)return Kr.get(e);let r=Rn.get(e);r||(r=new Map,Rn.set(e,r));let o=r.get(t);if(o!==void 0)return o;let n=Kr.get(e),a=Nn({root:n.root,path:[...n.path,t]});return r.set(t,a),a}},Wt=e=>e[Vn],xt=e=>{let{root:t,path:r}=Wt(e);return{root:t,path:r}};function Nn(e){var o;let t={root:e.root,path:(o=e.path)!=null?o:[]},r={};return Kr.set(r,t),new Proxy(r,cu)}var fe=Nn,je=e=>e&&!!Wt(e);function Hr(e,t,r){return t.length===0?r(e):Gt(e,t,r)}var Gt=(e,t,r)=>{if(t.length===0)return r(e);if(Array.isArray(e)){let[o,...n]=t;o=parseInt(String(o),10),isNaN(o)&&(o=0);let a=e[o],i=Gt(a,n,r);if(a===i)return e;let s=[...e];return s.splice(o,1,i),s}else if(typeof e=="object"&&e!==null){let[o,...n]=t,a=e[o],i=Gt(a,n,r);return a===i?e:R(y({},e),{[o]:i})}else{let[o,...n]=t;return{[o]:Gt(void 0,n,r)}}};var xe;(function(o){o[o.Dict=0]="Dict",o[o.Array=1]="Array",o[o.Other=2]="Other"})(xe||(xe={}));var Jr=e=>Array.isArray(e)?1:jt(e)?0:2,Ln=(e,t,r=Jr(e))=>r===0&&typeof t=="string"||r===1&&mu(t)?e[t]:void 0,mu=e=>{let t=typeof e=="number"?e:parseInt(e,10);return!isNaN(t)&&t>=0&&t<1/0&&(t|0)===t},Kt=class{constructor(t,r){this._parent=t;this._path=r;this.children=new Map;this.identityChangeListeners=new Set}addIdentityChangeListener(t){this.identityChangeListeners.add(t)}removeIdentityChangeListener(t){this.identityChangeListeners.delete(t),this._checkForGC()}removeChild(t){this.children.delete(t),this._checkForGC()}getChild(t){return this.children.get(t)}getOrCreateChild(t){let r=this.children.get(t);return r||(r=r=new Kt(this,this._path.concat([t])),this.children.set(t,r)),r}_checkForGC(){this.identityChangeListeners.size>0||this.children.size>0||this._parent&&this._parent.removeChild(An(this._path))}},O=class{constructor(t){this.$$isIdentityDerivationProvider=!0;this.reduceState=(t,r)=>{let o=Hr(this.getState(),t,r);return this.setState(o),o};this._onPathValueChange=(t,r)=>{let o=this._getOrCreateScopeForPath(t);return o.identityChangeListeners.add(r),()=>{o.identityChangeListeners.delete(r)}};this._currentState=t,this._rootScope=new Kt(void 0,[]),this.pointer=fe({root:this,path:[]})}setState(t){let r=this._currentState;this._currentState=t,this._checkUpdates(this._rootScope,r,t)}getState(){return this._currentState}getIn(t){return t.length===0?this.getState():tt(this.getState(),t)}setIn(t,r){return this.reduceState(t,()=>r)}_checkUpdates(t,r,o){if(r===o)return;for(let i of t.identityChangeListeners)i(o);if(t.children.size===0)return;let n=Jr(r),a=Jr(o);if(!(n===2&&n===a))for(let[i,s]of t.children){let u=Ln(r,i,n),p=Ln(o,i,a);this._checkUpdates(s,u,p)}}_getOrCreateScopeForPath(t){let r=this._rootScope;for(let o of t)r=r.getOrCreateChild(o);return r}getIdentityDerivation(t){return new Le(r=>this._onPathValueChange(t,r),()=>this.getIn(t))}},Mn=new WeakMap,$=e=>{let t=Wt(e),r=Mn.get(t);if(!r){let o=t.root;if(!hu(o))throw new Error("Cannot run valueDerivation() on a pointer whose root is not an IdentityChangeProvider");let{path:n}=t;r=o.getIdentityDerivation(n),Mn.set(t,r)}return r};function hu(e){return typeof e=="object"&&e!==null&&e.$$isIdentityDerivationProvider===!0}var P=e=>je(e)?$(e).getValue():oe(e)?e.getValue():e;var de=class{constructor(t){this._value=t;this._emitter=new Pe;this._publicDerivation=new Le(r=>this._emitter.tappable.tap(r),this.get.bind(this))}set(t){t!==this._value&&(this._value=t,this._emitter.emit(t))}get(){return this._value}get derivation(){return this._publicDerivation}};var ne=class extends G{constructor(t){super();return this._v=t,this}_recalculate(){return this._v}_reactToDependencyBecomingStale(){}};function gu(){let e=new Me;if(typeof window!="undefined"){let t=r=>{e.tick(r),window.requestAnimationFrame(t)};window.requestAnimationFrame(t)}else e.tick(0),setTimeout(()=>e.tick(1),0),console.log("@theatre/dataverse is running in a server rather than in a browser. We haven't gotten around to testing server-side rendering, so if something is working in the browser but not on the server, please file a bug: https://github.com/theatre-js/theatre/issues/new");return e}var Yr,Me=class{constructor(){this._ticking=!1;this._scheduledForThisOrNextTick=new Set,this._scheduledForNextTick=new Set,this._timeAtCurrentTick=0}static get raf(){return Yr||(Yr=gu()),Yr}onThisOrNextTick(t){this._scheduledForThisOrNextTick.add(t)}onNextTick(t){this._scheduledForNextTick.add(t)}offThisOrNextTick(t){this._scheduledForThisOrNextTick.delete(t)}offNextTick(t){this._scheduledForNextTick.delete(t)}get time(){return this._ticking?this._timeAtCurrentTick:performance.now()}tick(t=performance.now()){this._ticking=!0,this._timeAtCurrentTick=t;for(let r of this._scheduledForNextTick)this._scheduledForThisOrNextTick.add(r);this._scheduledForNextTick.clear(),this._tick(0),this._ticking=!1}_tick(t){let r=this.time;if(t>10&&console.warn("_tick() recursing for 10 times"),t>100)throw new Error("Maximum recursion limit for _tick()");let o=this._scheduledForThisOrNextTick;this._scheduledForThisOrNextTick=new Set;for(let n of o)n(r);if(this._scheduledForThisOrNextTick.size>0)return this._tick(t+1)}};var Bn=()=>{},Fn=class extends G{constructor(t){super();this._fn=t;this._cacheOfDendencyValues=new Map;this._possiblyStaleDeps=new Set;this._prismScope=new at}_recalculate(){let t;if(this._possiblyStaleDeps.size>0){let n=!1;ot();for(let a of this._possiblyStaleDeps)if(this._cacheOfDendencyValues.get(a)!==a.getValue()){n=!0;break}if(nt(),this._possiblyStaleDeps.clear(),!n)return this._lastValue}let r=new Set;this._cacheOfDendencyValues.clear();let o=n=>{r.add(n),this._addDependency(n)};Dn(o),ae.push(this._prismScope);try{t=this._fn()}catch(n){console.error(n)}finally{ae.pop()!==this._prismScope&&console.warn("The Prism hook stack has slipped. This is a bug.")}kn(o);for(let n of this._dependencies)r.has(n)||this._removeDependency(n);this._dependencies=r,ot();for(let n of r)this._cacheOfDendencyValues.set(n,n.getValue());return nt(),t}_reactToDependencyBecomingStale(t){this._possiblyStaleDeps.add(t)}_keepHot(){this._prismScope=new at,ot(),this.getValue(),nt()}_becomeCold(){$n(this._prismScope),this._prismScope=new at}},at=class{constructor(){this.isPrismScope=!0;this._subs={}}sub(t){return this._subs[t]||(this._subs[t]=new at),this._subs[t]}get subs(){return this._subs}};function $n(e){for(let t of Object.values(e.subs))$n(t);yu(e)}function yu(e){let t=Jt.get(e);if(t)for(let r of t.values())Ht(r.cleanup,void 0);Jt.delete(e)}function Ht(e,t){try{return{value:e(),ok:!0}}catch(r){return setTimeout(function(){throw r}),{value:t,ok:!1}}}var ae=new rt,zn=new WeakMap,Jt=new WeakMap,Un=new WeakMap;function bu(e,t){let r=ae.peek();if(!r)throw new Error("prism.ref() is called outside of a prism() call.");let o=zn.get(r);o===void 0&&(o=new Map,zn.set(r,o));let n=o.get(e);if(n!==void 0)return n;{let a={current:t};return o.set(e,a),a}}function vu(e,t,r){let o=ae.peek();if(!o)throw new Error("prism.effect() is called outside of a prism() call.");let n=Jt.get(o);n===void 0&&(n=new Map,Jt.set(o,n));let a=n.get(e);a===void 0&&(a={cleanup:Bn,deps:void 0},n.set(e,a)),qn(a.deps,r)&&(a.cleanup(),ot(),a.cleanup=Ht(t,Bn).value,nt(),a.deps=r)}function qn(e,t){if(e===void 0||t===void 0)return!0;let r=e.length;if(r!==t.length)return!0;for(let o=0;o<r;o++)if(e[o]!==t[o])return!0;return!1}function Wn(e,t,r){let o=ae.peek();if(!o)throw new Error("prism.memo() is called outside of a prism() call.");let n=Un.get(o);n||(n=new Map,Un.set(o,n));let a=n.get(e);return a===void 0&&(a={cachedValue:null,deps:void 0},n.set(e,a)),qn(a.deps,r)&&(ot(),a.cachedValue=Ht(t,void 0).value,nt(),a.deps=r),a.cachedValue}function _u(e,t){let{b:r,setValue:o}=te.memo("state/"+e,()=>{let n=new de(t);return{b:n,setValue:i=>n.set(i)}},[]);return[r.derivation.getValue(),o]}function Pu(){if(!ae.peek())throw new Error("The parent function is called outside of a prism() call.")}function ju(e,t){let r=ae.peek();if(!r)throw new Error("prism.scope() is called outside of a prism() call.");let o=r.sub(e);ae.push(o);let n=Ht(t,void 0).value;return ae.pop(),n}function xu(e,t,r){return Wn(e,()=>te(t),r).getValue()}function Iu(){return!!ae.peek()}var te=e=>new Fn(e);te.ref=bu;te.effect=vu;te.memo=Wn;te.ensurePrism=Pu;te.state=_u;te.scope=ju;te.sub=xu;te.inPrism=Iu;var b=te;var Be=class{constructor(t){this.$$isIdentityDerivationProvider=!0;this._currentPointerBox=new de(t),this.pointer=fe({root:this,path:[]})}setPointer(t){this._currentPointerBox.set(t)}getIdentityDerivation(t){return this._currentPointerBox.derivation.flatMap(r=>{let o=t.reduce((n,a)=>n[a],r);return $(o)})}};var Gn=class{constructor(){d(this,"atom",new O({projects:{}}))}add(t,r){this.atom.reduceState(["projects",t],()=>r)}get(t){return this.atom.getState().projects[t]}has(t){return!!this.get(t)}},Tu=new Gn,it=Tu;var Kn=new WeakMap;function S(e){return Kn.get(e)}function Ie(e,t){Kn.set(e,t)}var Yt=[];function Xr(e,t){return t.length===0?e:tt(e,t)}var Te=class{constructor(){d(this,"_values",{})}get(t,r){if(this.has(t))return this._values[t];{let o=r();return this._values[t]=o,o}}has(t){return this._values.hasOwnProperty(t)}};var Su=function(){try{var e=F(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),Zr=Su;function Au(e,t,r){t=="__proto__"&&Zr?Zr(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var Xt=Au;var wu=Object.prototype,Cu=wu.hasOwnProperty;function Ou(e,t,r){var o=e[t];(!(Cu.call(e,t)&&Xe(o,r))||r===void 0&&!(t in e))&&Xt(e,t,r)}var Hn=Ou;var Du=9007199254740991,ku=/^(?:0|[1-9]\d*)$/;function Eu(e,t){var r=typeof e;return t=t==null?Du:t,!!t&&(r=="number"||r!="symbol"&&ku.test(e))&&e>-1&&e%1==0&&e<t}var st=Eu;function Ru(e,t,r,o){if(!Z(e))return e;t=et(t,e);for(var n=-1,a=t.length,i=a-1,s=e;s!=null&&++n<a;){var u=re(t[n]),p=r;if(u==="__proto__"||u==="constructor"||u==="prototype")return e;if(n!=i){var l=s[u];p=o?o(l,u,s):void 0,p===void 0&&(p=Z(l)?l:st(t[n+1])?[]:{})}Hn(s,u,p),s=s[u]}return e}var Jn=Ru;function Vu(e,t,r){return e==null?e:Jn(e,t,r)}var Yn=Vu;var Qr=new WeakMap;function eo(e){return to(e)}function to(e){if(Qr.has(e))return Qr.get(e);let t=e.type==="compound"?Lu(e):e.type==="enum"?Nu(e):e.default;return Qr.set(e,t),t}function Nu(e){let t={$case:e.defaultCase};for(let[r,o]of Object.entries(e.cases))t[r]=to(o);return t}function Lu(e){let t={};for(let[r,o]of Object.entries(e.props))t[r]=to(o);return t}var Qn=Rt(Zn());function ro(e,t,r){return b(()=>{let o=P(t);return b.memo("driver",()=>o?o.type==="BasicKeyframedTrack"?Bu(e,o,r):(e.logger.error("Track type not yet supported."),new ne(void 0)):new ne(void 0),[o]).getValue()})}function Bu(e,t,r){return b(()=>{let o=b.ref("state",{started:!1}),n=o.current,a=r.getValue();return(!n.started||a<n.validFrom||n.validTo<=a)&&(o.current=n=Fu(e,r,t)),n.der.getValue()})}var ea=new ne(void 0);function Fu(e,t,r){let o=t.getValue();if(r.keyframes.length===0)return{started:!0,validFrom:-1/0,validTo:1/0,der:ea};let n=0;for(;;){let a=r.keyframes[n];if(!a)return Fe.error;let i=n===r.keyframes.length-1;if(o<a.position)return n===0?Fe.beforeFirstKeyframe(a):Fe.error;if(a.position===o)return i?Fe.lastKeyframe(a):Fe.between(a,r.keyframes[n+1],t);if(n===r.keyframes.length-1)return Fe.lastKeyframe(a);{let s=n+1;if(r.keyframes[s].position<=o){n=s;continue}else return Fe.between(a,r.keyframes[n+1],t)}}}var Fe={beforeFirstKeyframe(e){return{started:!0,validFrom:-1/0,validTo:e.position,der:new ne({left:e.value,progression:0})}},lastKeyframe(e){return{started:!0,validFrom:e.position,validTo:1/0,der:new ne({left:e.value,progression:0})}},between(e,t,r){if(!e.connectedRight)return{started:!0,validFrom:e.position,validTo:t.position,der:new ne({left:e.value,progression:0})};let o=new Qn.default(e.handles[2],e.handles[3],t.handles[0],t.handles[1]),n=i=>(i-e.position)/(t.position-e.position),a=b(()=>{let i=n(r.getValue()),s=o.solveSimple(i);return{left:e.value,right:t.value,progression:s}});return{started:!0,validFrom:e.position,validTo:t.position,der:a}},error:{started:!0,validFrom:-1/0,validTo:1/0,der:ea}};function pt(e,t,r){let n=r.get(e);if(n&&n.override===t)return n.merged;let a=y({},e);for(let i of Object.keys(t)){let s=t[i],u=e[i];a[i]=typeof s=="object"&&typeof u=="object"?pt(u,s,r):s===void 0?u:s}return r.set(e,{override:t,merged:a}),a}function Zt(e,t){let r=e;for(let o of t)r=r[o];return r}var ta=(e,t)=>{let r=b.memo(e,()=>new O(t),[]);return r.setState(t),r};var $u=Me.raf,ce=$u;var Qt=class{constructor(t){d(this,"_cache",new Te);Ie(this,t)}get type(){return"Theatre_SheetObject_PublicAPI"}get props(){return S(this).propsP}get sheet(){return S(this).sheet.publicApi}get project(){return S(this).sheet.project.publicApi}get address(){return y({},S(this).address)}_valuesDerivation(){return this._cache.get("onValuesChangeDerivation",()=>{let t=S(this);return b(()=>P(t.getValues().getValue()))})}onValuesChange(t){return this._valuesDerivation().tapImmediate(ce,t)}get value(){return this._valuesDerivation().getValue()}set initialValue(t){S(this).setInitialValue(t)}};function It(e){return e.type==="compound"||e.type==="enum"}function Tt(e,t){if(!e)return;let[r,...o]=t;if(r===void 0)return e;if(!It(e))return;let n=e.type==="enum"?e.cases[r]:e.props[r];return Tt(n,o)}function ra(e){return!It(e)}var Nb=new WeakMap;var er=class{constructor(t,r,o){this.sheet=t;this.template=r;this.nativeObject=o;d(this,"$$isIdentityDerivationProvider",!0);d(this,"address");d(this,"publicApi");d(this,"_initialValue",new O({}));d(this,"_cache",new Te);d(this,"_logger");d(this,"_internalUtilCtx");this._logger=t._logger.named("SheetObject",r.address.objectKey),this._logger._trace("creating object"),this._internalUtilCtx={logger:this._logger.utilFor.internal()},this.address=R(y({},r.address),{sheetInstanceId:t.address.sheetInstanceId}),this.publicApi=new Qt(this)}get type(){return"Theatre_SheetObject"}getValues(){return this._cache.get("getValues()",()=>b(()=>{let t=P(this.template.getDefaultValues()),r=P(this._initialValue.pointer),o=b.memo("withInitialCache",()=>new WeakMap,[]),n=pt(t,r,o),a=P(this.template.getStaticValues()),i=b.memo("withStatics",()=>new WeakMap,[]),u=pt(n,a,i),p;{let m=b.memo("seq",()=>this.getSequencedValues(),[]),h=b.memo("withSeqsCache",()=>new WeakMap,[]);p=P(P(m)),u=pt(u,p,h)}return ta("finalAtom",u).pointer}))}getValueByPointer(t){let r=P(this.getValues()),{path:o}=xt(t);return P(Zt(r,o))}getIdentityDerivation(t){return b(()=>{let r=P(this.getValues());return P(Zt(r,t))})}getSequencedValues(){return b(()=>{let t=b.memo("tracksToProcess",()=>this.template.getArrayOfValidSequenceTracks(),[]),r=P(t),o=new O({});return b.effect("processTracks",()=>{let n=[];for(let{trackId:a,pathToProp:i}of r){let s=this._trackIdToDerivation(a),u=Tt(this.template.config,i),p=u.deserializeAndSanitize,l=u.interpolate,m=()=>{let f=s.getValue();if(!f)return o.setIn(i,void 0);let g=p(f.left),_=g===void 0?u.default:g;if(f.right===void 0)return o.setIn(i,_);let j=p(f.right),x=j===void 0?u.default:j;return o.setIn(i,l(_,x,f.progression))},h=s.changesWithoutValues().tap(m);m(),n.push(h)}return()=>{for(let a of n)a()}},r),o.pointer})}_trackIdToDerivation(t){let r=this.template.project.pointers.historic.sheetsById[this.address.sheetId].sequence.tracksByObject[this.address.objectKey].trackData[t],o=this.sheet.getSequence().positionDerivation;return ro(this._internalUtilCtx,r,o)}get propsP(){return this._cache.get("propsP",()=>fe({root:this,path:[]}))}validateValue(t,r){}setInitialValue(t){this.validateValue(this.propsP,t),this._initialValue.setState(t)}};function A(e){return function(r,o){return e(r,o())}}var L;(function(o){o[o.GENERAL=1]="GENERAL",o[o.TODO=2]="TODO",o[o.TROUBLESHOOTING=4]="TROUBLESHOOTING"})(L||(L={}));var D;(function(o){o[o.INTERNAL=8]="INTERNAL",o[o.DEV=16]="DEV",o[o.PUBLIC=32]="PUBLIC"})(D||(D={}));var v;(function(n){n[n.TRACE=64]="TRACE",n[n.DEBUG=128]="DEBUG",n[n.WARN=256]="WARN",n[n.ERROR=512]="ERROR"})(v||(v={}));var c;(function(f){f[f.ERROR_PUBLIC=545]="ERROR_PUBLIC",f[f.ERROR_DEV=529]="ERROR_DEV",f[f._HMM=524]="_HMM",f[f._TODO=522]="_TODO",f[f._ERROR=521]="_ERROR",f[f.WARN_PUBLIC=289]="WARN_PUBLIC",f[f.WARN_DEV=273]="WARN_DEV",f[f._KAPOW=268]="_KAPOW",f[f._WARN=265]="_WARN",f[f.DEBUG_DEV=145]="DEBUG_DEV",f[f._DEBUG=137]="_DEBUG",f[f.TRACE_DEV=81]="TRACE_DEV",f[f._TRACE=73]="_TRACE"})(c||(c={}));var K={_hmm:H(524),_todo:H(522),_error:H(521),errorDev:H(529),errorPublic:H(545),_kapow:H(268),_warn:H(265),warnDev:H(273),warnPublic:H(289),_debug:H(137),debugDev:H(145),_trace:H(73),traceDev:H(81)};function H(e){return Object.freeze({audience:$e(e,8)?"internal":$e(e,16)?"dev":"public",category:$e(e,4)?"troubleshooting":$e(e,2)?"todo":"general",level:$e(e,512)?512:$e(e,256)?256:$e(e,128)?128:64})}function $e(e,t){return(e&t)===t}function w(e,t){return((t&32)==32?!0:(t&16)==16?e.dev:(t&8)==8?e.internal:!1)&&e.min<=t}var me={loggingConsoleStyle:!0,loggerConsoleStyle:!0,includes:Object.freeze({internal:!1,dev:!1,min:256}),filtered:function(){},include:function(){return{}},create:null,creatExt:null,named(e,t,r){return this.create({names:[...e.names,{name:t,key:r}]})},style:{bold:void 0,italic:void 0,cssMemo:new Map([["",""]]),collapseOnRE:/[a-z- ]+/g,color:void 0,collapsed(e){if(e.length<5)return e;let t=e.replace(this.collapseOnRE,"");return this.cssMemo.has(t)||this.cssMemo.set(t,this.css(e)),t},css(e){var o,n,a,i;let t=this.cssMemo.get(e);if(t)return t;let r=`color:${(n=(o=this.color)==null?void 0:o.call(this,e))!=null?n:`hsl(${(e.charCodeAt(0)+e.charCodeAt(e.length-1))%360}, 100%, 60%)`}`;return((a=this.bold)==null?void 0:a.test(e))&&(r+=";font-weight:600"),((i=this.italic)==null?void 0:i.test(e))&&(r+=";font-style:italic"),this.cssMemo.set(e,r),r}}};function St(e=console,t={}){let r=R(y({},me),{includes:y({},me.includes)}),o={styled:qu.bind(r,e),noStyle:Gu.bind(r,e)},n=Uu.bind(r);function a(){return r.loggingConsoleStyle&&r.loggerConsoleStyle?o.styled:o.noStyle}return r.create=a(),{configureLogger(i){var s;i==="console"?(r.loggerConsoleStyle=me.loggerConsoleStyle,r.create=a()):i.type==="console"?(r.loggerConsoleStyle=(s=i.style)!=null?s:me.loggerConsoleStyle,r.create=a()):i.type==="keyed"?(r.creatExt=u=>i.keyed(u.names),r.create=n):i.type==="named"&&(r.creatExt=zu.bind(null,i.named),r.create=n)},configureLogging(i){var s,u,p,l,m;r.includes.dev=(s=i.dev)!=null?s:me.includes.dev,r.includes.internal=(u=i.internal)!=null?u:me.includes.internal,r.includes.min=(p=i.min)!=null?p:me.includes.min,r.include=(l=i.include)!=null?l:me.include,r.loggingConsoleStyle=(m=i.consoleStyle)!=null?m:me.loggingConsoleStyle,r.create=a()},getLogger(){return r.create({names:[]})}}}function zu(e,t){let r=[];for(let{name:o,key:n}of t.names)r.push(n==null?o:`${o} (${n})`);return e(r)}function Uu(e){let t=y(y({},this.includes),this.include(e)),r=this.filtered,o=this.named.bind(this,e),n=this.creatExt(e),a=w(t,524),i=w(t,522),s=w(t,521),u=w(t,529),p=w(t,545),l=w(t,265),m=w(t,268),h=w(t,273),f=w(t,289),g=w(t,137),_=w(t,145),j=w(t,73),x=w(t,81),I=a?n.error.bind(n,K._hmm):r.bind(e,524),E=i?n.error.bind(n,K._todo):r.bind(e,522),B=s?n.error.bind(n,K._error):r.bind(e,521),Y=u?n.error.bind(n,K.errorDev):r.bind(e,529),Ae=p?n.error.bind(n,K.errorPublic):r.bind(e,545),we=m?n.warn.bind(n,K._kapow):r.bind(e,268),Ce=l?n.warn.bind(n,K._warn):r.bind(e,265),Oe=h?n.warn.bind(n,K.warnDev):r.bind(e,273),De=f?n.warn.bind(n,K.warnPublic):r.bind(e,273),ke=g?n.debug.bind(n,K._debug):r.bind(e,137),Ee=_?n.debug.bind(n,K.debugDev):r.bind(e,145),Re=j?n.trace.bind(n,K._trace):r.bind(e,73),Ve=x?n.trace.bind(n,K.traceDev):r.bind(e,81),k={_hmm:I,_todo:E,_error:B,errorDev:Y,errorPublic:Ae,_kapow:we,_warn:Ce,warnDev:Oe,warnPublic:De,_debug:ke,debugDev:Ee,_trace:Re,traceDev:Ve,lazy:{_hmm:a?A(I):I,_todo:i?A(E):E,_error:s?A(B):B,errorDev:u?A(Y):Y,errorPublic:p?A(Ae):Ae,_kapow:m?A(we):we,_warn:l?A(Ce):Ce,warnDev:h?A(Oe):Oe,warnPublic:f?A(De):De,_debug:g?A(ke):ke,debugDev:_?A(Ee):Ee,_trace:j?A(Re):Re,traceDev:x?A(Ve):Ve},named:o,utilFor:{internal(){return{debug:k._debug,error:k._error,warn:k._warn,trace:k._trace,named(U,T){return k.named(U,T).utilFor.internal()}}},dev(){return{debug:k.debugDev,error:k.errorDev,warn:k.warnDev,trace:k.traceDev,named(U,T){return k.named(U,T).utilFor.dev()}}},public(){return{error:k.errorPublic,warn:k.warnPublic,debug(U,T){k._warn(`(public "debug" filtered out) ${U}`,T)},trace(U,T){k._warn(`(public "trace" filtered out) ${U}`,T)},named(U,T){return k.named(U,T).utilFor.public()}}}}};return k}function qu(e,t){let r=y(y({},this.includes),this.include(t)),o=[],n="";for(let u=0;u<t.names.length;u++){let{name:p,key:l}=t.names[u];if(n+=` %c${p}`,o.push(this.style.css(p)),l!=null){let m=`%c#${l}`;n+=m,o.push(this.style.css(m))}}let a=this.filtered,i=this.named.bind(this,t),s=[n,...o];return oa(a,t,r,e,s,Wu(s),i)}function Wu(e){let t=e.slice(0);for(let r=1;r<t.length;r++)t[r]+=";background-color:#e0005a;padding:2px;color:white";return t}function Gu(e,t){let r=y(y({},this.includes),this.include(t)),o="";for(let s=0;s<t.names.length;s++){let{name:u,key:p}=t.names[s];o+=` ${u}`,p!=null&&(o+=`#${p}`)}let n=this.filtered,a=this.named.bind(this,t),i=[o];return oa(n,t,r,e,i,i,a)}function oa(e,t,r,o,n,a,i){let s=w(r,524),u=w(r,522),p=w(r,521),l=w(r,529),m=w(r,545),h=w(r,265),f=w(r,268),g=w(r,273),_=w(r,289),j=w(r,137),x=w(r,145),I=w(r,73),E=w(r,81),B=s?o.error.bind(o,...n):e.bind(t,524),Y=u?o.error.bind(o,...n):e.bind(t,522),Ae=p?o.error.bind(o,...n):e.bind(t,521),we=l?o.error.bind(o,...n):e.bind(t,529),Ce=m?o.error.bind(o,...n):e.bind(t,545),Oe=f?o.warn.bind(o,...a):e.bind(t,268),De=h?o.warn.bind(o,...n):e.bind(t,265),ke=g?o.warn.bind(o,...n):e.bind(t,273),Ee=_?o.warn.bind(o,...n):e.bind(t,273),Re=j?o.info.bind(o,...n):e.bind(t,137),Ve=x?o.info.bind(o,...n):e.bind(t,145),k=I?o.debug.bind(o,...n):e.bind(t,73),U=E?o.debug.bind(o,...n):e.bind(t,81),T={_hmm:B,_todo:Y,_error:Ae,errorDev:we,errorPublic:Ce,_kapow:Oe,_warn:De,warnDev:ke,warnPublic:Ee,_debug:Re,debugDev:Ve,_trace:k,traceDev:U,lazy:{_hmm:s?A(B):B,_todo:u?A(Y):Y,_error:p?A(Ae):Ae,errorDev:l?A(we):we,errorPublic:m?A(Ce):Ce,_kapow:f?A(Oe):Oe,_warn:h?A(De):De,warnDev:g?A(ke):ke,warnPublic:_?A(Ee):Ee,_debug:j?A(Re):Re,debugDev:x?A(Ve):Ve,_trace:I?A(k):k,traceDev:E?A(U):U},named:i,utilFor:{internal(){return{debug:T._debug,error:T._error,warn:T._warn,trace:T._trace,named(se,pe){return T.named(se,pe).utilFor.internal()}}},dev(){return{debug:T.debugDev,error:T.errorDev,warn:T.warnDev,trace:T.traceDev,named(se,pe){return T.named(se,pe).utilFor.dev()}}},public(){return{error:T.errorPublic,warn:T.warnPublic,debug(se,pe){T._warn(`(public "debug" filtered out) ${se}`,pe)},trace(se,pe){T._warn(`(public "trace" filtered out) ${se}`,pe)},named(se,pe){return T.named(se,pe).utilFor.public()}}}}};return T}var na=St(console,{_debug:function(){},_error:function(){}});na.configureLogging({dev:!0,min:v.TRACE});var tr=na.getLogger().named("Theatre.js (default logger)").utilFor.dev();var aa=new WeakMap;function oo(e){let t=aa.get(e);if(t)return t;let r=new Map;return aa.set(e,r),ia([],e,r),r}function ia(e,t,r){for(let[o,n]of Object.entries(t.props))if(!It(n)){let a=[...e,o];r.set(JSON.stringify(a),r.size),sa(a,n,r)}for(let[o,n]of Object.entries(t.props))if(It(n)){let a=[...e,o];r.set(JSON.stringify(a),r.size),sa(a,n,r)}}function sa(e,t,r){if(t.type==="compound")ia(e,t,r);else{if(t.type==="enum")throw new Error("Enums aren't supported yet");r.set(JSON.stringify(e),r.size)}}var rr=class{constructor(t,r,o,n){this.sheetTemplate=t;d(this,"address");d(this,"type","Theatre_SheetObjectTemplate");d(this,"_config");d(this,"_cache",new Te);d(this,"project");this.address=R(y({},t.address),{objectKey:r}),this._config=new O(n),this.project=t.project}get config(){return this._config.getState()}createInstance(t,r,o){return this._config.setState(o),new er(t,this,r)}overrideConfig(t){this._config.setState(t)}getDefaultValues(){return this._cache.get("getDefaultValues()",()=>b(()=>{let t=P(this._config.pointer);return eo(t)}))}getStaticValues(){return this._cache.get("getDerivationOfStatics",()=>b(()=>{var a;let t=this.sheetTemplate.project.pointers.historic.sheetsById[this.address.sheetId],r=(a=P(t.staticOverrides.byObject[this.address.objectKey]))!=null?a:{};return P(this._config.pointer).deserializeAndSanitize(r)||{}}))}getArrayOfValidSequenceTracks(){return this._cache.get("getArrayOfValidSequenceTracks",()=>b(()=>{let t=this.project.pointers.historic.sheetsById[this.address.sheetId],r=P(t.sequence.tracksByObject[this.address.objectKey].trackIdByPropPath);if(!r)return Yt;let o=[];if(!r)return Yt;let n=Object.entries(r);for(let[i,s]of n){let u=Ku(i);if(!u)continue;let p=Tt(this.config,u);!(p&&ra(p))||o.push({pathToProp:u,trackId:s})}let a=oo(this.config);return o.sort((i,s)=>{let u=i.pathToProp,p=s.pathToProp,l=a.get(JSON.stringify(u)),m=a.get(JSON.stringify(p));return l>m?1:-1}),o.length===0?Yt:o}))}getMapOfValidSequenceTracks_forStudio(){return this._cache.get("getMapOfValidSequenceTracks_forStudio",()=>this.getArrayOfValidSequenceTracks().map(t=>{let r={};for(let{pathToProp:o,trackId:n}of t)Yn(r,o,n);return r}))}getDefaultsAtPointer(t){let{path:r}=xt(t),o=this.getDefaultValues().getValue();return Xr(o,r)}};function Ku(e){try{return JSON.parse(e)}catch(t){tr.warn(`property ${JSON.stringify(e)} cannot be parsed. Skipping.`);return}}var Yu=Rt(da());var ca=class extends Error{},Q=class extends ca{};var Xu=/\s/;function Zu(e){for(var t=e.length;t--&&Xu.test(e.charAt(t)););return t}var ma=Zu;var Qu=/^\s+/;function el(e){return e&&e.slice(0,ma(e)+1).replace(Qu,"")}var ha=el;var ga=0/0,tl=/^[-+]0x[0-9a-f]+$/i,rl=/^0b[01]+$/i,ol=/^0o[0-7]+$/i,nl=parseInt;function al(e){if(typeof e=="number")return e;if(ge(e))return ga;if(Z(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Z(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ha(e);var r=rl.test(e);return r||ol.test(e)?nl(e.slice(2),r?2:8):tl.test(e)?ga:+e}var ut=al;var ya=1/0,il=17976931348623157e292;function sl(e){if(!e)return e===0?e:0;if(e=ut(e),e===ya||e===-ya){var t=e<0?-1:1;return t*il}return e===e?e:0}var ba=sl;function pl(e){var t=ba(e),r=t%1;return t===t?r?t-r:t:0}var va=pl;function ul(e){return e}var _a=ul;var ll=F(V,"WeakMap"),nr=ll;var fl=9007199254740991;function dl(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=fl}var lt=dl;function cl(e){return e!=null&&lt(e.length)&&!Nt(e)}var Pa=cl;var ml=Object.prototype;function hl(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||ml;return e===r}var ja=hl;function gl(e,t){for(var r=-1,o=Array(e);++r<e;)o[r]=t(r);return o}var xa=gl;var yl="[object Arguments]";function bl(e){return W(e)&&q(e)==yl}var ao=bl;var Ia=Object.prototype,vl=Ia.hasOwnProperty,_l=Ia.propertyIsEnumerable,Pl=ao(function(){return arguments}())?ao:function(e){return W(e)&&vl.call(e,"callee")&&!_l.call(e,"callee")},ar=Pl;function jl(){return!1}var Ta=jl;var Sa=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Aa=Sa&&typeof module=="object"&&module&&!module.nodeType&&module,xl=Aa&&Aa.exports===Sa,wa=xl?V.Buffer:void 0,Il=wa?wa.isBuffer:void 0,Tl=Il||Ta,At=Tl;var Sl="[object Arguments]",Al="[object Array]",wl="[object Boolean]",Cl="[object Date]",Ol="[object Error]",Dl="[object Function]",kl="[object Map]",El="[object Number]",Rl="[object Object]",Vl="[object RegExp]",Nl="[object Set]",Ll="[object String]",Ml="[object WeakMap]",Bl="[object ArrayBuffer]",Fl="[object DataView]",$l="[object Float32Array]",zl="[object Float64Array]",Ul="[object Int8Array]",ql="[object Int16Array]",Wl="[object Int32Array]",Gl="[object Uint8Array]",Kl="[object Uint8ClampedArray]",Hl="[object Uint16Array]",Jl="[object Uint32Array]",C={};C[$l]=C[zl]=C[Ul]=C[ql]=C[Wl]=C[Gl]=C[Kl]=C[Hl]=C[Jl]=!0;C[Sl]=C[Al]=C[Bl]=C[wl]=C[Fl]=C[Cl]=C[Ol]=C[Dl]=C[kl]=C[El]=C[Rl]=C[Vl]=C[Nl]=C[Ll]=C[Ml]=!1;function Yl(e){return W(e)&&lt(e.length)&&!!C[q(e)]}var Ca=Yl;function Xl(e){return function(t){return e(t)}}var Oa=Xl;var Da=typeof exports=="object"&&exports&&!exports.nodeType&&exports,wt=Da&&typeof module=="object"&&module&&!module.nodeType&&module,Zl=wt&&wt.exports===Da,io=Zl&&Vt.process,Ql=function(){try{var e=wt&&wt.require&&wt.require("util").types;return e||io&&io.binding&&io.binding("util")}catch(t){}}(),so=Ql;var ka=so&&so.isTypedArray,ef=ka?Oa(ka):Ca,ir=ef;var tf=Object.prototype,rf=tf.hasOwnProperty;function of(e,t){var r=N(e),o=!r&&ar(e),n=!r&&!o&&At(e),a=!r&&!o&&!n&&ir(e),i=r||o||n||a,s=i?xa(e.length,String):[],u=s.length;for(var p in e)(t||rf.call(e,p))&&!(i&&(p=="length"||n&&(p=="offset"||p=="parent")||a&&(p=="buffer"||p=="byteLength"||p=="byteOffset")||st(p,u)))&&s.push(p);return s}var Ea=of;var nf=$t(Object.keys,Object),Ra=nf;var af=Object.prototype,sf=af.hasOwnProperty;function pf(e){if(!ja(e))return Ra(e);var t=[];for(var r in Object(e))sf.call(e,r)&&r!="constructor"&&t.push(r);return t}var Va=pf;function uf(e){return Pa(e)?Ea(e):Va(e)}var ft=uf;function lf(e,t){for(var r=-1,o=t.length,n=e.length;++r<o;)e[n+r]=t[r];return e}var Na=lf;function ff(e,t,r){var o=-1,n=e.length;t<0&&(t=-t>n?0:n+t),r=r>n?n:r,r<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(n);++o<n;)a[o]=e[o+t];return a}var La=ff;function df(e,t,r){var o=e.length;return r=r===void 0?o:r,!t&&r>=o?e:La(e,t,r)}var Ma=df;var cf="\\ud800-\\udfff",mf="\\u0300-\\u036f",hf="\\ufe20-\\ufe2f",gf="\\u20d0-\\u20ff",yf=mf+hf+gf,bf="\\ufe0e\\ufe0f",vf="\\u200d",_f=RegExp("["+vf+cf+yf+bf+"]");function Pf(e){return _f.test(e)}var dt=Pf;function jf(e){return e.split("")}var Ba=jf;var Fa="\\ud800-\\udfff",xf="\\u0300-\\u036f",If="\\ufe20-\\ufe2f",Tf="\\u20d0-\\u20ff",Sf=xf+If+Tf,Af="\\ufe0e\\ufe0f",wf="["+Fa+"]",po="["+Sf+"]",uo="\\ud83c[\\udffb-\\udfff]",Cf="(?:"+po+"|"+uo+")",$a="[^"+Fa+"]",za="(?:\\ud83c[\\udde6-\\uddff]){2}",Ua="[\\ud800-\\udbff][\\udc00-\\udfff]",Of="\\u200d",qa=Cf+"?",Wa="["+Af+"]?",Df="(?:"+Of+"(?:"+[$a,za,Ua].join("|")+")"+Wa+qa+")*",kf=Wa+qa+Df,Ef="(?:"+[$a+po+"?",po,za,Ua,wf].join("|")+")",Rf=RegExp(uo+"(?="+uo+")|"+Ef+kf,"g");function Vf(e){return e.match(Rf)||[]}var Ga=Vf;function Nf(e){return dt(e)?Ga(e):Ba(e)}var Ka=Nf;function Lf(e,t,r){return e===e&&(r!==void 0&&(e=e<=r?e:r),t!==void 0&&(e=e>=t?e:t)),e}var Ha=Lf;function Mf(e,t,r){return r===void 0&&(r=t,t=void 0),r!==void 0&&(r=ut(r),r=r===r?r:0),t!==void 0&&(t=ut(t),t=t===t?t:0),Ha(ut(e),t,r)}var Ct=Mf;function Bf(){this.__data__=new be,this.size=0}var Ja=Bf;function Ff(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var Ya=Ff;function $f(e){return this.__data__.get(e)}var Xa=$f;function zf(e){return this.__data__.has(e)}var Za=zf;var Uf=200;function qf(e,t){var r=this.__data__;if(r instanceof be){var o=r.__data__;if(!ve||o.length<Uf-1)return o.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ne(o)}return r.set(e,t),this.size=r.size,this}var Qa=qf;function ct(e){var t=this.__data__=new be(e);this.size=t.size}ct.prototype.clear=Ja;ct.prototype.delete=Ya;ct.prototype.get=Xa;ct.prototype.has=Za;ct.prototype.set=Qa;var mt=ct;function Wf(e,t){for(var r=-1,o=e==null?0:e.length,n=0,a=[];++r<o;){var i=e[r];t(i,r,e)&&(a[n++]=i)}return a}var ei=Wf;function Gf(){return[]}var ti=Gf;var Kf=Object.prototype,Hf=Kf.propertyIsEnumerable,ri=Object.getOwnPropertySymbols,Jf=ri?function(e){return e==null?[]:(e=Object(e),ei(ri(e),function(t){return Hf.call(e,t)}))}:ti,oi=Jf;function Yf(e,t,r){var o=t(e);return N(e)?o:Na(o,r(e))}var ni=Yf;function Xf(e){return ni(e,ft,oi)}var lo=Xf;var Zf=F(V,"DataView"),sr=Zf;var Qf=F(V,"Promise"),pr=Qf;var ed=F(V,"Set"),ur=ed;var ai="[object Map]",td="[object Object]",ii="[object Promise]",si="[object Set]",pi="[object WeakMap]",ui="[object DataView]",rd=ue(sr),od=ue(ve),nd=ue(pr),ad=ue(ur),id=ue(nr),ze=q;(sr&&ze(new sr(new ArrayBuffer(1)))!=ui||ve&&ze(new ve)!=ai||pr&&ze(pr.resolve())!=ii||ur&&ze(new ur)!=si||nr&&ze(new nr)!=pi)&&(ze=function(e){var t=q(e),r=t==td?e.constructor:void 0,o=r?ue(r):"";if(o)switch(o){case rd:return ui;case od:return ai;case nd:return ii;case ad:return si;case id:return pi}return t});var fo=ze;var sd=V.Uint8Array,co=sd;var pd="__lodash_hash_undefined__";function ud(e){return this.__data__.set(e,pd),this}var li=ud;function ld(e){return this.__data__.has(e)}var fi=ld;function lr(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Ne;++t<r;)this.add(e[t])}lr.prototype.add=lr.prototype.push=li;lr.prototype.has=fi;var di=lr;function fd(e,t){for(var r=-1,o=e==null?0:e.length;++r<o;)if(t(e[r],r,e))return!0;return!1}var ci=fd;function dd(e,t){return e.has(t)}var mi=dd;var cd=1,md=2;function hd(e,t,r,o,n,a){var i=r&cd,s=e.length,u=t.length;if(s!=u&&!(i&&u>s))return!1;var p=a.get(e),l=a.get(t);if(p&&l)return p==t&&l==e;var m=-1,h=!0,f=r&md?new di:void 0;for(a.set(e,t),a.set(t,e);++m<s;){var g=e[m],_=t[m];if(o)var j=i?o(_,g,m,t,e,a):o(g,_,m,e,t,a);if(j!==void 0){if(j)continue;h=!1;break}if(f){if(!ci(t,function(x,I){if(!mi(f,I)&&(g===x||n(g,x,r,o,a)))return f.push(I)})){h=!1;break}}else if(!(g===_||n(g,_,r,o,a))){h=!1;break}}return a.delete(e),a.delete(t),h}var fr=hd;function gd(e){var t=-1,r=Array(e.size);return e.forEach(function(o,n){r[++t]=[n,o]}),r}var hi=gd;function yd(e){var t=-1,r=Array(e.size);return e.forEach(function(o){r[++t]=o}),r}var gi=yd;var bd=1,vd=2,_d="[object Boolean]",Pd="[object Date]",jd="[object Error]",xd="[object Map]",Id="[object Number]",Td="[object RegExp]",Sd="[object Set]",Ad="[object String]",wd="[object Symbol]",Cd="[object ArrayBuffer]",Od="[object DataView]",yi=X?X.prototype:void 0,mo=yi?yi.valueOf:void 0;function Dd(e,t,r,o,n,a,i){switch(r){case Od:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Cd:return!(e.byteLength!=t.byteLength||!a(new co(e),new co(t)));case _d:case Pd:case Id:return Xe(+e,+t);case jd:return e.name==t.name&&e.message==t.message;case Td:case Ad:return e==t+"";case xd:var s=hi;case Sd:var u=o&bd;if(s||(s=gi),e.size!=t.size&&!u)return!1;var p=i.get(e);if(p)return p==t;o|=vd,i.set(e,t);var l=fr(s(e),s(t),o,n,a,i);return i.delete(e),l;case wd:if(mo)return mo.call(e)==mo.call(t)}return!1}var bi=Dd;var kd=1,Ed=Object.prototype,Rd=Ed.hasOwnProperty;function Vd(e,t,r,o,n,a){var i=r&kd,s=lo(e),u=s.length,p=lo(t),l=p.length;if(u!=l&&!i)return!1;for(var m=u;m--;){var h=s[m];if(!(i?h in t:Rd.call(t,h)))return!1}var f=a.get(e),g=a.get(t);if(f&&g)return f==t&&g==e;var _=!0;a.set(e,t),a.set(t,e);for(var j=i;++m<u;){h=s[m];var x=e[h],I=t[h];if(o)var E=i?o(I,x,h,t,e,a):o(x,I,h,e,t,a);if(!(E===void 0?x===I||n(x,I,r,o,a):E)){_=!1;break}j||(j=h=="constructor")}if(_&&!j){var B=e.constructor,Y=t.constructor;B!=Y&&"constructor"in e&&"constructor"in t&&!(typeof B=="function"&&B instanceof B&&typeof Y=="function"&&Y instanceof Y)&&(_=!1)}return a.delete(e),a.delete(t),_}var vi=Vd;var Nd=1,_i="[object Arguments]",Pi="[object Array]",dr="[object Object]",Ld=Object.prototype,ji=Ld.hasOwnProperty;function Md(e,t,r,o,n,a){var i=N(e),s=N(t),u=i?Pi:fo(e),p=s?Pi:fo(t);u=u==_i?dr:u,p=p==_i?dr:p;var l=u==dr,m=p==dr,h=u==p;if(h&&At(e)){if(!At(t))return!1;i=!0,l=!1}if(h&&!l)return a||(a=new mt),i||ir(e)?fr(e,t,r,o,n,a):bi(e,t,u,r,o,n,a);if(!(r&Nd)){var f=l&&ji.call(e,"__wrapped__"),g=m&&ji.call(t,"__wrapped__");if(f||g){var _=f?e.value():e,j=g?t.value():t;return a||(a=new mt),n(_,j,r,o,a)}}return h?(a||(a=new mt),vi(e,t,r,o,n,a)):!1}var xi=Md;function Ii(e,t,r,o,n){return e===t?!0:e==null||t==null||!W(e)&&!W(t)?e!==e&&t!==t:xi(e,t,r,o,Ii,n)}var cr=Ii;var Bd=1,Fd=2;function $d(e,t,r,o){var n=r.length,a=n,i=!o;if(e==null)return!a;for(e=Object(e);n--;){var s=r[n];if(i&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++n<a;){s=r[n];var u=s[0],p=e[u],l=s[1];if(i&&s[2]){if(p===void 0&&!(u in e))return!1}else{var m=new mt;if(o)var h=o(p,l,u,e,t,m);if(!(h===void 0?cr(l,p,Bd|Fd,o,m):h))return!1}}return!0}var Ti=$d;function zd(e){return e===e&&!Z(e)}var mr=zd;function Ud(e){for(var t=ft(e),r=t.length;r--;){var o=t[r],n=e[o];t[r]=[o,n,mr(n)]}return t}var Si=Ud;function qd(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var hr=qd;function Wd(e){var t=Si(e);return t.length==1&&t[0][2]?hr(t[0][0],t[0][1]):function(r){return r===e||Ti(r,e,t)}}var Ai=Wd;function Gd(e,t){return e!=null&&t in Object(e)}var wi=Gd;function Kd(e,t,r){t=et(t,e);for(var o=-1,n=t.length,a=!1;++o<n;){var i=re(t[o]);if(!(a=e!=null&&r(e,i)))break;e=e[i]}return a||++o!=n?a:(n=e==null?0:e.length,!!n&&lt(n)&&st(i,n)&&(N(e)||ar(e)))}var Ci=Kd;function Hd(e,t){return e!=null&&Ci(e,t,wi)}var Oi=Hd;var Jd=1,Yd=2;function Xd(e,t){return Je(e)&&mr(t)?hr(re(e),t):function(r){var o=tt(r,e);return o===void 0&&o===t?Oi(r,e):cr(t,o,Jd|Yd)}}var Di=Xd;function Zd(e){return function(t){return t==null?void 0:t[e]}}var gr=Zd;function Qd(e){return function(t){return Ft(t,e)}}var ki=Qd;function ec(e){return Je(e)?gr(re(e)):ki(e)}var Ei=ec;function tc(e){return typeof e=="function"?e:e==null?_a:typeof e=="object"?N(e)?Di(e[0],e[1]):Ai(e):Ei(e)}var Ri=tc;function rc(e){return function(t,r,o){for(var n=-1,a=Object(t),i=o(t),s=i.length;s--;){var u=i[e?s:++n];if(r(a[u],u,a)===!1)break}return t}}var Vi=rc;var oc=Vi(),Ni=oc;function nc(e,t){return e&&Ni(e,t,ft)}var Li=nc;function ac(e,t){var r={};return t=Ri(t,3),Li(e,function(o,n,a){Xt(r,n,t(o,n,a))}),r}var ho=ac;var ic=9007199254740991,sc=Math.floor;function pc(e,t){var r="";if(!e||t<1||t>ic)return r;do t%2&&(r+=e),t=sc(t/2),t&&(e+=e);while(t);return r}var go=pc;var uc=gr("length"),Mi=uc;var Bi="\\ud800-\\udfff",lc="\\u0300-\\u036f",fc="\\ufe20-\\ufe2f",dc="\\u20d0-\\u20ff",cc=lc+fc+dc,mc="\\ufe0e\\ufe0f",hc="["+Bi+"]",yo="["+cc+"]",bo="\\ud83c[\\udffb-\\udfff]",gc="(?:"+yo+"|"+bo+")",Fi="[^"+Bi+"]",$i="(?:\\ud83c[\\udde6-\\uddff]){2}",zi="[\\ud800-\\udbff][\\udc00-\\udfff]",yc="\\u200d",Ui=gc+"?",qi="["+mc+"]?",bc="(?:"+yc+"(?:"+[Fi,$i,zi].join("|")+")"+qi+Ui+")*",vc=qi+Ui+bc,_c="(?:"+[Fi+yo+"?",yo,$i,zi,hc].join("|")+")",Wi=RegExp(bo+"(?="+bo+")|"+_c+vc,"g");function Pc(e){for(var t=Wi.lastIndex=0;Wi.test(e);)++t;return t}var Gi=Pc;function jc(e){return dt(e)?Gi(e):Mi(e)}var yr=jc;var xc=Math.ceil;function Ic(e,t){t=t===void 0?" ":Mt(t);var r=t.length;if(r<2)return r?go(t,e):t;var o=go(t,xc(e/yr(t)));return dt(t)?Ma(Ka(o),0,e).join(""):o.slice(0,e)}var Ki=Ic;function Tc(e,t,r){e=Bt(e),t=va(t);var o=t?yr(e):0;return t&&o<t?Ki(t-o,r)+e:e}var Ue=Tc;function ie(){let e,t,r=new Promise((n,a)=>{e=i=>{n(i),o.status="resolved"},t=i=>{a(i),o.status="rejected"}}),o={resolve:e,reject:t,promise:r,status:"pending"};return o}var Sc=()=>{},ht=Sc;var br=class{constructor(t){this._ticker=t;d(this,"_stopPlayCallback",ht);d(this,"_state",new O({position:0,playing:!1}));d(this,"statePointer");this.statePointer=this._state.pointer}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=ht}gotoPosition(t){this._updatePositionInState(t)}_updatePositionInState(t){this._state.reduceState(["position"],()=>t)}getCurrentPosition(){return this._state.getState().position}get playing(){return this._state.getState().playing}set playing(t){this._state.setIn(["playing"],t)}play(t,r,o,n){this.playing&&this.pause(),this.playing=!0;let a=this._ticker,i=r[1]-r[0];{let f=this.getCurrentPosition();f<r[0]||f>r[1]?n==="normal"||n==="alternate"?this._updatePositionInState(r[0]):(n==="reverse"||n==="alternateReverse")&&this._updatePositionInState(r[1]):n==="normal"||n==="alternate"?f===r[1]&&this._updatePositionInState(r[0]):f===r[0]&&this._updatePositionInState(r[1])}let s=ie(),u=a.time,p=i*t,l=this.getCurrentPosition()-r[0];(n==="reverse"||n==="alternateReverse")&&(l=r[1]-this.getCurrentPosition());let m=f=>{let _=Math.max(f-u,0)/1e3,j=Math.min(_*o+l,p);if(j!==p){let x=Math.floor(j/i),I=j/i%1*i;if(n!=="normal")if(n==="reverse")I=i-I;else{let E=x%2==0;n==="alternate"?E||(I=i-I):E&&(I=i-I)}this._updatePositionInState(I+r[0]),h()}else{if(n==="normal")this._updatePositionInState(r[1]);else if(n==="reverse")this._updatePositionInState(r[0]);else{let x=(t-1)%2==0;n==="alternate"?x?this._updatePositionInState(r[1]):this._updatePositionInState(r[0]):x?this._updatePositionInState(r[0]):this._updatePositionInState(r[1])}this.playing=!1,s.resolve(!0)}};this._stopPlayCallback=()=>{a.offThisOrNextTick(m),a.offNextTick(m),this.playing&&s.resolve(!1)};let h=()=>a.onNextTick(m);return a.onThisOrNextTick(m),s.promise}playDynamicRange(t){this.playing&&this.pause(),this.playing=!0;let r=this._ticker,o=ie(),n=t.keepHot();o.promise.then(n,n);let a=r.time,i=u=>{let p=Math.max(u-a,0);a=u;let l=p/1e3,m=this.getCurrentPosition(),h=t.getValue();if(m<h[0]||m>h[1])this.gotoPosition(h[0]);else{let f=m+l;f>h[1]&&(f=h[0]+(f-h[1])),this.gotoPosition(f)}s()};this._stopPlayCallback=()=>{r.offThisOrNextTick(i),r.offNextTick(i),o.resolve(!1)};let s=()=>r.onNextTick(i);return r.onThisOrNextTick(i),o.promise}};var vr=class{constructor(t,r,o,n){this._ticker=t;this._decodedBuffer=r;this._audioContext=o;this._nodeDestination=n;d(this,"_mainGain");d(this,"_state",new O({position:0,playing:!1}));d(this,"statePointer");d(this,"_stopPlayCallback",ht);this.statePointer=this._state.pointer,this._mainGain=this._audioContext.createGain(),this._mainGain.connect(this._nodeDestination)}playDynamicRange(t){throw new Error("Method not implemented.")}get _playing(){return this._state.getState().playing}set _playing(t){this._state.setIn(["playing"],t)}destroy(){}pause(){this._stopPlayCallback(),this._playing=!1,this._stopPlayCallback=ht}gotoPosition(t){this._updatePositionInState(t)}_updatePositionInState(t){this._state.reduceState(["position"],()=>t)}getCurrentPosition(){return this._state.getState().position}play(t,r,o,n){this._playing&&this.pause(),this._playing=!0;let a=this._ticker,i=this.getCurrentPosition(),s=r[1]-r[0];if(n!=="normal")throw new Q(`Audio-controlled sequences can only be played in the "normal" direction. '${n}' given.`);i<r[0]||i>r[1]?this._updatePositionInState(r[0]):i===r[1]&&this._updatePositionInState(r[0]),i=this.getCurrentPosition();let u=ie(),p=this._audioContext.createBufferSource();p.buffer=this._decodedBuffer,p.connect(this._mainGain),p.playbackRate.value=o,t>1e3&&(console.warn("Audio-controlled sequences cannot have an iterationCount larger than 1000. It has been clamped to 1000."),t=1e3),t>1&&(p.loop=!0,p.loopStart=r[0],p.loopEnd=r[1]);let l=a.time,m=i-r[0],h=s*t;p.start(0,i,h-m);let f=j=>{let I=Math.max(j-l,0)/1e3,E=Math.min(I*o+m,h);if(E!==h){let B=E/s%1*s;this._updatePositionInState(B+r[0]),_()}else this._updatePositionInState(r[1]),this._playing=!1,g(),u.resolve(!0)},g=()=>{p.stop(),p.disconnect()};this._stopPlayCallback=()=>{g(),a.offThisOrNextTick(f),a.offNextTick(f),this._playing&&u.resolve(!1)};let _=()=>a.onNextTick(f);return a.onThisOrNextTick(f),u.promise}};var _r=class{get type(){return"Theatre_Sequence_PublicAPI"}constructor(t){Ie(this,t)}play(t){let r=S(this);if(r._project.isReady())return r.play(t);{let o=ie();return o.resolve(!0),o.promise}}pause(){S(this).pause()}get position(){return S(this).position}set position(t){S(this).position=t}async attachAudio(t){let{audioContext:r,destinationNode:o,decodedBuffer:n,gainNode:a}=await Ac(t),i=new vr(ce,n,r,a);return S(this).replacePlaybackController(i),{audioContext:r,destinationNode:o,decodedBuffer:n,gainNode:a}}get pointer(){return S(this).pointer}};async function Ac(e){function t(){if(e.audioContext)return Promise.resolve(e.audioContext);let p=new AudioContext;return p.state==="running"||typeof window=="undefined"?Promise.resolve(p):new Promise(l=>{let m=()=>{p.resume()},h=["mousedown","keydown","touchstart"],f={capture:!0,passive:!1};h.forEach(g=>{window.addEventListener(g,m,f)}),p.addEventListener("statechange",()=>{p.state==="running"&&(h.forEach(g=>{window.removeEventListener(g,m,f)}),l(p))})})}async function r(){if(e.source instanceof AudioBuffer)return e.source;let p=ie();if(typeof e.source!="string")throw new Error("Error validating arguments to sequence.attachAudio(). args.source must either be a string or an instance of AudioBuffer.");let l;try{l=await fetch(e.source)}catch(g){throw console.error(g),new Error(`Could not fetch '${e.source}'. Network error logged above.`)}let m;try{m=await l.arrayBuffer()}catch(g){throw console.error(g),new Error(`Could not read '${e.source}' as an arrayBuffer.`)}(await o).decodeAudioData(m,p.resolve,p.reject);let f;try{f=await p.promise}catch(g){throw console.error(g),new Error(`Could not decode ${e.source} as an audio file.`)}return f}let o=t(),n=r(),[a,i]=await Promise.all([o,n]),s=e.destinationNode||a.destination,u=a.createGain();return u.connect(s),{audioContext:a,decodedBuffer:i,gainNode:u,destinationNode:s}}var Pr=class{constructor(t,r,o,n,a){this._project=t;this._sheet=r;this._lengthD=o;this._subUnitsPerUnitD=n;d(this,"address");d(this,"publicApi");d(this,"_playbackControllerBox");d(this,"_statePointerDerivation");d(this,"_positionD");d(this,"_positionFormatterD");d(this,"_playableRangeD");d(this,"pointer",fe({root:this,path:[]}));d(this,"$$isIdentityDerivationProvider",!0);d(this,"_logger");d(this,"closestGridPosition",t=>{let r=this.subUnitsPerUnit,o=1/r;return parseFloat((Math.round(t/o)*o).toFixed(3))});this._logger=t._logger.named("Sheet",r.address.sheetId).named("Instance",r.address.sheetInstanceId),this.address=R(y({},this._sheet.address),{sequenceName:"default"}),this.publicApi=new _r(this),this._playbackControllerBox=new de(a!=null?a:new br(ce)),this._statePointerDerivation=this._playbackControllerBox.derivation.map(i=>i.statePointer),this._positionD=this._statePointerDerivation.flatMap(i=>$(i.position)),this._positionFormatterD=this._subUnitsPerUnitD.map(i=>new Hi(i))}getIdentityDerivation(t){if(t.length===0)return b(()=>({length:P(this.pointer.length),playing:P(this.pointer.playing),position:P(this.pointer.position)}));if(t.length>1)return b(()=>{});let[r]=t;return r==="length"?this._lengthD:r==="position"?this._positionD:r==="playing"?b(()=>P(this._statePointerDerivation.getValue().playing)):b(()=>{})}get positionFormatter(){return this._positionFormatterD.getValue()}get derivationToStatePointer(){return this._statePointerDerivation}get length(){return this._lengthD.getValue()}get positionDerivation(){return this._positionD}get position(){return this._playbackControllerBox.get().getCurrentPosition()}get subUnitsPerUnit(){return this._subUnitsPerUnitD.getValue()}get positionSnappedToGrid(){return this.closestGridPosition(this.position)}set position(t){let r=t;this.pause(),r>this.length&&(r=this.length);let o=this.length;this._playbackControllerBox.get().gotoPosition(r>o?o:r)}getDurationCold(){return this._lengthD.getValue()}get playing(){return P(this._playbackControllerBox.get().statePointer.playing)}_makeRangeFromSequenceTemplate(){return b(()=>[0,P(this._lengthD)])}playDynamicRange(t){return this._playbackControllerBox.get().playDynamicRange(t)}async play(t){let r=this.length,o=t&&t.range?t.range:[0,r],n=t&&typeof t.iterationCount=="number"?t.iterationCount:1,a=t&&typeof t.rate!="undefined"?t.rate:1,i=t&&t.direction?t.direction:"normal";return await this._play(n,[o[0],o[1]],a,i)}_play(t,r,o,n){return this._playbackControllerBox.get().play(t,r,o,n)}pause(){this._playbackControllerBox.get().pause()}replacePlaybackController(t){this.pause();let r=this._playbackControllerBox.get();this._playbackControllerBox.set(t);let o=r.getCurrentPosition();r.destroy(),t.gotoPosition(o)}},Hi=class{constructor(t){this._fps=t}formatSubUnitForGrid(t){let r=t%1,o=1/this._fps;return Math.round(r/o)+"f"}formatFullUnitForGrid(t){let r=t,o="";r>=gt&&(o+=Math.floor(r/gt)+"h",r=r%gt),r>=We&&(o+=Math.floor(r/We)+"m",r=r%We),r>=qe&&(o+=Math.floor(r/qe)+"s",r=r%qe);let n=1/this._fps;return r>=n&&(o+=Math.floor(r/n)+"f",r=r%n),o.length===0?"0s":o}formatForPlayhead(t){let r=t,o="";if(r>=gt){let a=Math.floor(r/gt);o+=Ue(a.toString(),2,"0")+"h",r=r%gt}if(r>=We){let a=Math.floor(r/We);o+=Ue(a.toString(),2,"0")+"m",r=r%We}else o.length>0&&(o+="00m");if(r>=qe){let a=Math.floor(r/qe);o+=Ue(a.toString(),2,"0")+"s",r=r%qe}else o+="00s";let n=1/this._fps;if(r>=n){let a=Math.round(r/n);o+=Ue(a.toString(),2,"0")+"f",r=r%n}else r/n>.98?(o+=Ue(1 .toString(),2,"0")+"f",r=r%n):o+="00f";return o.length===0?"00s00f":o}formatBasic(t){return t.toFixed(2)+"s"}},qe=1,We=qe*60,gt=We*60;var Ir={};Fr(Ir,{boolean:()=>jo,compound:()=>Ot,number:()=>Po,rgba:()=>Nc,string:()=>xo,stringLiteral:()=>$c});function jr(e,t){return e.length<=t?e:e.substr(0,t-3)+"..."}var wc=e=>typeof e=="string"?`string("${jr(e,10)}")`:typeof e=="number"?`number(${jr(String(e),10)})`:e===null?"null":e===void 0?"undefined":typeof e=="boolean"?String(e):Array.isArray(e)?"array":typeof e=="object"?"object":"unknown",yt=wc;function Cc(e,{removeAlphaIfOpaque:t=!1}={}){let r=(e.a*255|1<<8).toString(16).slice(1);return`#${(e.r*255|1<<8).toString(16).slice(1)+(e.g*255|1<<8).toString(16).slice(1)+(e.b*255|1<<8).toString(16).slice(1)+(t&&r==="ff"?"":r)}`}function xr(e){return R(y({},e),{toString(){return Cc(this,{removeAlphaIfOpaque:!0})}})}function Oc(e){return Object.fromEntries(Object.entries(e).map(([t,r])=>[t,Ct(r,0,1)]))}function Ji(e){function t(r){return r>=.0031308?1.055*r**(1/2.4)-.055:12.92*r}return Oc({r:t(e.r),g:t(e.g),b:t(e.b),a:e.a})}function vo(e){function t(r){return r>=.04045?((r+.055)/(1+.055))**2.4:r/12.92}return{r:t(e.r),g:t(e.g),b:t(e.b),a:e.a}}function _o(e){let t=.4122214708*e.r+.5363325363*e.g+.0514459929*e.b,r=.2119034982*e.r+.6806995451*e.g+.1073969566*e.b,o=.0883024619*e.r+.2817188376*e.g+.6299787005*e.b,n=Math.cbrt(t),a=Math.cbrt(r),i=Math.cbrt(o);return{L:.2104542553*n+.793617785*a-.0040720468*i,a:1.9779984951*n-2.428592205*a+.4505937099*i,b:.0259040371*n+.7827717662*a-.808675766*i,alpha:e.a}}function Yi(e){let t=e.L+.3963377774*e.a+.2158037573*e.b,r=e.L-.1055613458*e.a-.0638541728*e.b,o=e.L-.0894841775*e.a-1.291485548*e.b,n=t*t*t,a=r*r*r,i=o*o*o;return{r:4.0767416621*n-3.3077115913*a+.2309699292*i,g:-1.2684380046*n+2.6097574011*a-.3413193965*i,b:-.0041960863*n-.7034186147*a+1.707614701*i,a:e.alpha}}var Se=Symbol("TheatrePropType_Basic");function Xi(e){return typeof e=="object"&&!!e&&e[Se]==="TheatrePropType"}function Dc(e){if(typeof e=="number")return Po(e);if(typeof e=="boolean")return jo(e);if(typeof e=="string")return xo(e);if(typeof e=="object"&&!!e){if(Xi(e))return e;if(jt(e))return Ot(e);throw new Q(`This value is not a valid prop type: ${yt(e)}`)}else throw new Q(`This value is not a valid prop type: ${yt(e)}`)}function Zi(e){let t={};for(let r of Object.keys(e)){let o=e[r];Xi(o)?t[r]=o:t[r]=Dc(o)}return t}var kc=(e,t)=>{},Ot=(e,t={})=>{kc("t.compound(props, opts)",t);let r=Zi(e),o=new WeakMap;return{type:"compound",props:r,valueType:null,[Se]:"TheatrePropType",label:t.label,default:ho(r,a=>a.default),deserializeAndSanitize:a=>{if(typeof a!="object"||!a)return;if(o.has(a))return o.get(a);let i={},s=!1;for(let[u,p]of Object.entries(r))if(Object.prototype.hasOwnProperty.call(a,u)){let l=p.deserializeAndSanitize(a[u]);l!=null&&(s=!0,i[u]=l)}if(o.set(a,i),s)return i}}},Po=(e,t={})=>{var r;return R(y({type:"number",valueType:0,default:e,[Se]:"TheatrePropType"},t||{}),{label:t.label,nudgeFn:(r=t.nudgeFn)!=null?r:zc,nudgeMultiplier:typeof t.nudgeMultiplier=="number"?t.nudgeMultiplier:1,interpolate:Vc,deserializeAndSanitize:Ec(t.range)})},Ec=e=>e?t=>{if(!!(typeof t=="number"&&isFinite(t)))return Ct(t,e[0],e[1])}:Rc,Rc=e=>typeof e=="number"&&isFinite(e)?e:void 0,Vc=(e,t,r)=>e+r*(t-e),Nc=(e={r:0,g:0,b:0,a:1},t={})=>{let r={};for(let o of["r","g","b","a"])r[o]=Math.min(Math.max(e[o],0),1);return{type:"rgba",valueType:null,default:xr(r),[Se]:"TheatrePropType",label:t.label,interpolate:Mc,deserializeAndSanitize:Lc}},Lc=e=>{if(!e)return;let t=!0;for(let o of["r","g","b","a"])(!Object.prototype.hasOwnProperty.call(e,o)||typeof e[o]!="number")&&(t=!1);if(!t)return;let r={};for(let o of["r","g","b","a"])r[o]=Math.min(Math.max(e[o],0),1);return xr(r)},Mc=(e,t,r)=>{let o=_o(vo(e)),n=_o(vo(t)),a={L:(1-r)*o.L+r*n.L,a:(1-r)*o.a+r*n.a,b:(1-r)*o.b+r*n.b,alpha:(1-r)*o.alpha+r*n.alpha},i=Ji(Yi(a));return xr(i)},jo=(e,t={})=>{var r;return{type:"boolean",default:e,valueType:null,[Se]:"TheatrePropType",label:t.label,interpolate:(r=t.interpolate)!=null?r:Io,deserializeAndSanitize:Bc}},Bc=e=>typeof e=="boolean"?e:void 0;function Io(e){return e}var xo=(e,t={})=>{var r;return{type:"string",default:e,valueType:null,[Se]:"TheatrePropType",label:t.label,interpolate:(r=t.interpolate)!=null?r:Io,deserializeAndSanitize:Fc}};function Fc(e){return typeof e=="string"?e:void 0}function $c(e,t,r={}){var o,n;return{type:"stringLiteral",default:e,valuesAndLabels:y({},t),[Se]:"TheatrePropType",valueType:null,as:(o=r.as)!=null?o:"menu",label:r.label,interpolate:(n=r.interpolate)!=null?n:Io,deserializeAndSanitize(a){if(typeof a=="string"&&Object.prototype.hasOwnProperty.call(t,a))return a}}}var zc=({config:e,deltaX:t,deltaFraction:r,magnitude:o})=>{let{range:n}=e;return n?r*(n[1]-n[0])*o*e.nudgeMultiplier:t*o*e.nudgeMultiplier};var Uc=e=>e.replace(/^[\s\/]*/,"").replace(/[\s\/]*$/,"").replace(/\s*\/\s*/g," / "),qc=e=>{if(typeof e!="string")return`it is not a string. (it is a ${typeof e})`;let t=e.split(/\//);if(t.length===0)return"it is empty.";for(let r=0;r<t.length;r++){let o=t[r].trim();if(o.length===0)return`the component #${r+1} is empty.`;if(o.length>32)return`the component '${o}' must have 32 characters or less.`}};function Tr(e,t){let r=Uc(e);return r}var DI=Rt(To()),EI=new WeakMap,Sr=class{get type(){return"Theatre_Sheet_PublicAPI"}constructor(t){Ie(this,t)}object(t,r){let o=S(this),n=Tr(t,`sheet.object("${t}", ...)`),a=o.getObject(n),i=null;if(a)return a.publicApi;{let s=Ot(r);return o.createObject(n,i,s).publicApi}}get sequence(){return S(this).getSequence().publicApi}get project(){return S(this).project.publicApi}get address(){return y({},S(this).address)}};var Ar=class{constructor(t,r){this.template=t;this.instanceId=r;d(this,"_objects",new O({}));d(this,"_sequence");d(this,"address");d(this,"publicApi");d(this,"project");d(this,"objectsP",this._objects.pointer);d(this,"type","Theatre_Sheet");d(this,"_logger");this._logger=t.project._logger.named("Sheet",r),this._logger._trace("creating sheet"),this.project=t.project,this.address=R(y({},t.address),{sheetInstanceId:this.instanceId}),this.publicApi=new Sr(this)}createObject(t,r,o){let a=this.template.getObjectTemplate(t,r,o).createInstance(this,r,o);return this._objects.setIn([t],a),a}getObject(t){return this._objects.getState()[t]}getSequence(){if(!this._sequence){let t=$(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.length).map(o=>typeof o=="number"?o:10),r=$(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.subUnitsPerUnit).map(o=>typeof o=="number"?o:30);this._sequence=new Pr(this.template.project,this,t,r)}return this._sequence}};var wr=class{constructor(t,r){this.project=t;d(this,"type","Theatre_SheetTemplate");d(this,"address");d(this,"_instances",new O({}));d(this,"instancesP",this._instances.pointer);d(this,"_objectTemplates",new O({}));d(this,"objectTemplatesP",this._objectTemplates.pointer);this.address=R(y({},t.address),{sheetId:r})}getInstance(t){let r=this._instances.getState()[t];return r||(r=new Ar(this,t),this._instances.setIn([t],r)),r}getObjectTemplate(t,r,o){let n=this._objectTemplates.getState()[t];return n||(n=new rr(this,t,r,o),this._objectTemplates.setIn([t],n)),n}};var Wc=e=>new Promise(t=>setTimeout(t,e)),es=Wc;function ee(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];if(!1)var n,a;throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Ge(e){return!!e&&!!e[z]}function Ke(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var o=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===Qc}(e)||Array.isArray(e)||!!e[fs]||!!e.constructor[fs]||Ao(e)||wo(e))}function ts(e){return Ge(e)||ee(23,e),e[z].t}function Dt(e,t,r){r===void 0&&(r=!1),bt(e)===0?(r?Object.keys:Fo)(e).forEach(function(o){r&&typeof o=="symbol"||t(o,e[o],e)}):e.forEach(function(o,n){return t(n,o,e)})}function bt(e){var t=e[z];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Ao(e)?2:wo(e)?3:0}function So(e,t){return bt(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Gc(e,t){return bt(e)===2?e.get(t):e[t]}function rs(e,t,r){var o=bt(e);o===2?e.set(t,r):o===3?(e.delete(t),e.add(r)):e[t]=r}function Kc(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function Ao(e){return Xc&&e instanceof Map}function wo(e){return Zc&&e instanceof Set}function He(e){return e.o||e.t}function Co(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=em(e);delete t[z];for(var r=Fo(t),o=0;o<r.length;o++){var n=r[o],a=t[n];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[n]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[n]})}return Object.create(Object.getPrototypeOf(e),t)}function Oo(e,t){return t===void 0&&(t=!1),Do(e)||Ge(e)||!Ke(e)||(bt(e)>1&&(e.set=e.add=e.clear=e.delete=Hc),Object.freeze(e),t&&Dt(e,function(r,o){return Oo(o,!0)},!0)),e}function Hc(){ee(2)}function Do(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function he(e){var t=tm[e];return t||ee(18,e),t}function os(){return kt}function ko(e,t){t&&(he("Patches"),e.u=[],e.s=[],e.v=t)}function Cr(e){Eo(e),e.p.forEach(Jc),e.p=null}function Eo(e){e===kt&&(kt=e.l)}function ns(e){return kt={p:[],l:kt,h:e,m:!0,_:0}}function Jc(e){var t=e[z];t.i===0||t.i===1?t.j():t.O=!0}function Ro(e,t){t._=t.p.length;var r=t.p[0],o=e!==void 0&&e!==r;return t.h.g||he("ES5").S(t,e,o),o?(r[z].P&&(Cr(t),ee(4)),Ke(e)&&(e=Or(t,e),t.l||Dr(t,e)),t.u&&he("Patches").M(r[z],e,t.u,t.s)):e=Or(t,r,[]),Cr(t),t.u&&t.v(t.u,t.s),e!==ls?e:void 0}function Or(e,t,r){if(Do(t))return t;var o=t[z];if(!o)return Dt(t,function(a,i){return as(e,o,t,a,i,r)},!0),t;if(o.A!==e)return t;if(!o.P)return Dr(e,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var n=o.i===4||o.i===5?o.o=Co(o.k):o.o;Dt(o.i===3?new Set(n):n,function(a,i){return as(e,o,n,a,i,r)}),Dr(e,n,!1),r&&e.u&&he("Patches").R(o,r,e.u,e.s)}return o.o}function as(e,t,r,o,n,a){if(Ge(n)){var i=Or(e,n,a&&t&&t.i!==3&&!So(t.D,o)?a.concat(o):void 0);if(rs(r,o,i),!Ge(i))return;e.m=!1}if(Ke(n)&&!Do(n)){if(!e.h.F&&e._<1)return;Or(e,n),t&&t.A.l||Dr(e,n)}}function Dr(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&Oo(t,r)}function Vo(e,t){var r=e[z];return(r?He(r):e)[t]}function is(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var o=Object.getOwnPropertyDescriptor(r,t);if(o)return o;r=Object.getPrototypeOf(r)}}function No(e){e.P||(e.P=!0,e.l&&No(e.l))}function Lo(e){e.o||(e.o=Co(e.t))}function Mo(e,t,r){var o=Ao(t)?he("MapSet").N(t,r):wo(t)?he("MapSet").T(t,r):e.g?function(n,a){var i=Array.isArray(n),s={i:i?1:0,A:a?a.A:os(),P:!1,I:!1,D:{},l:a,t:n,k:null,o:null,j:null,C:!1},u=s,p=kr;i&&(u=[s],p=Er);var l=Proxy.revocable(u,p),m=l.revoke,h=l.proxy;return s.k=h,s.j=m,h}(t,r):he("ES5").J(t,r);return(r?r.A:os()).p.push(o),o}function Yc(e){return Ge(e)||ee(22,e),function t(r){if(!Ke(r))return r;var o,n=r[z],a=bt(r);if(n){if(!n.P&&(n.i<4||!he("ES5").K(n)))return n.t;n.I=!0,o=ss(r,a),n.I=!1}else o=ss(r,a);return Dt(o,function(i,s){n&&Gc(n.t,i)===s||rs(o,i,t(s))}),a===3?new Set(o):o}(e)}function ss(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Co(e)}var ps,kt,Bo=typeof Symbol!="undefined"&&typeof Symbol("x")=="symbol",Xc=typeof Map!="undefined",Zc=typeof Set!="undefined",us=typeof Proxy!="undefined"&&Proxy.revocable!==void 0&&typeof Reflect!="undefined",ls=Bo?Symbol.for("immer-nothing"):((ps={})["immer-nothing"]=!0,ps),fs=Bo?Symbol.for("immer-draftable"):"__$immer_draftable",z=Bo?Symbol.for("immer-state"):"__$immer_state",qI=typeof Symbol!="undefined"&&Symbol.iterator||"@@iterator";var Qc=""+Object.prototype.constructor,Fo=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,em=Object.getOwnPropertyDescriptors||function(e){var t={};return Fo(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},tm={},kr={get:function(e,t){if(t===z)return e;var r=He(e);if(!So(r,t))return function(n,a,i){var s,u=is(a,i);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(n.k):void 0}(e,r,t);var o=r[t];return e.I||!Ke(o)?o:o===Vo(e.t,t)?(Lo(e),e.o[t]=Mo(e.A.h,o,e)):o},has:function(e,t){return t in He(e)},ownKeys:function(e){return Reflect.ownKeys(He(e))},set:function(e,t,r){var o=is(He(e),t);if(o==null?void 0:o.set)return o.set.call(e.k,r),!0;if(!e.P){var n=Vo(He(e),t),a=n==null?void 0:n[z];if(a&&a.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(Kc(r,n)&&(r!==void 0||So(e.t,t)))return!0;Lo(e),No(e)}return e.o[t]===r&&typeof r!="number"&&(r!==void 0||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return Vo(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,Lo(e),No(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=He(e),o=Reflect.getOwnPropertyDescriptor(r,t);return o&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:o.enumerable,value:r[t]}},defineProperty:function(){ee(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){ee(12)}},Er={};Dt(kr,function(e,t){Er[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Er.deleteProperty=function(e,t){return kr.deleteProperty.call(this,e[0],t)},Er.set=function(e,t,r){return kr.set.call(this,e[0],t,r,e[0])};var rm=function(){function e(r){var o=this;this.g=us,this.F=!0,this.produce=function(n,a,i){if(typeof n=="function"&&typeof a!="function"){var s=a;a=n;var u=o;return function(f){var g=this;f===void 0&&(f=s);for(var _=arguments.length,j=Array(_>1?_-1:0),x=1;x<_;x++)j[x-1]=arguments[x];return u.produce(f,function(I){var E;return(E=a).call.apply(E,[g,I].concat(j))})}}var p;if(typeof a!="function"&&ee(6),i!==void 0&&typeof i!="function"&&ee(7),Ke(n)){var l=ns(o),m=Mo(o,n,void 0),h=!0;try{p=a(m),h=!1}finally{h?Cr(l):Eo(l)}return typeof Promise!="undefined"&&p instanceof Promise?p.then(function(f){return ko(l,i),Ro(f,l)},function(f){throw Cr(l),f}):(ko(l,i),Ro(p,l))}if(!n||typeof n!="object")return(p=a(n))===ls?void 0:(p===void 0&&(p=n),o.F&&Oo(p,!0),p);ee(21,n)},this.produceWithPatches=function(n,a){return typeof n=="function"?function(u){for(var p=arguments.length,l=Array(p>1?p-1:0),m=1;m<p;m++)l[m-1]=arguments[m];return o.produceWithPatches(u,function(h){return n.apply(void 0,[h].concat(l))})}:[o.produce(n,a,function(u,p){i=u,s=p}),i,s];var i,s},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){Ke(r)||ee(8),Ge(r)&&(r=Yc(r));var o=ns(this),n=Mo(this,r,void 0);return n[z].C=!0,Eo(o),n},t.finishDraft=function(r,o){var n=r&&r[z],a=n.A;return ko(a,o),Ro(void 0,a)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!us&&ee(20),this.g=r},t.applyPatches=function(r,o){var n;for(n=o.length-1;n>=0;n--){var a=o[n];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}var i=he("Patches").$;return Ge(r)?i(r,o):this.produce(r,function(s){return i(s,o.slice(n+1))})},e}(),J=new rm,WI=J.produce,GI=J.produceWithPatches.bind(J),KI=J.setAutoFreeze.bind(J),HI=J.setUseProxies.bind(J),JI=J.applyPatches.bind(J),YI=J.createDraft.bind(J),XI=J.finishDraft.bind(J);var om={currentProjectStateDefinitionVersion:"0.4.0"},vt=om;async function $o(e,t,r){await es(0),e.transaction(({drafts:o})=>{var l;let n=t.address.projectId;o.ephemeral.coreByProject[n]={lastExportedObject:null,loadingState:{type:"loading"}},o.ahistoric.coreByProject[n]={ahistoricStuff:""};function a(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]={sheetsById:{},definitionVersion:vt.currentProjectStateDefinitionVersion,revisionHistory:[]}}function i(m){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]=m}function s(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"}}function u(m){o.ephemeral.coreByProject[n].loadingState={type:"browserStateIsNotBasedOnDiskState",onDiskState:m}}let p=(l=ts(o.historic))==null?void 0:l.coreByProject[t.address.projectId];p?r&&p.revisionHistory.indexOf(r.revisionHistory[0])==-1?u(r):s():r?i(r):a()})}function ds(){}function Rr(e){var a,i;let t=((a=e==null?void 0:e.logging)==null?void 0:a.internal)?(i=e.logging.min)!=null?i:v.WARN:1/0,r=t<=v.DEBUG,o=t<=v.ERROR,n=St(void 0,{_debug:r?console.debug.bind(console,"_coreLogger(TheatreInternalLogger) debug"):ds,_error:o?console.error.bind(console,"_coreLogger(TheatreInternalLogger) error"):ds});if(e){let{logger:s,logging:u}=e;s&&n.configureLogger(s),u?n.configureLogging(u):n.configureLogging({dev:!1})}return n.getLogger().named("Theatre")}var Vr=class{constructor(t,r={},o){this.config=r;this.publicApi=o;d(this,"pointers");d(this,"_pointerProxies");d(this,"address");d(this,"_readyDeferred");d(this,"_sheetTemplates",new O({}));d(this,"sheetTemplatesP",this._sheetTemplates.pointer);d(this,"_studio");d(this,"type","Theatre_Project");d(this,"_logger");var a;this._logger=Rr(r.experiments).named("Project",t),this._logger.traceDev("creating project"),this.address={projectId:t},this._logger._kapow('this is a "kapow"');let n=new O({ahistoric:{ahistoricStuff:""},historic:(a=r.state)!=null?a:{sheetsById:{},definitionVersion:vt.currentProjectStateDefinitionVersion,revisionHistory:[]},ephemeral:{loadingState:{type:"loaded"},lastExportedObject:null}});this._pointerProxies={historic:new Be(n.pointer.historic),ahistoric:new Be(n.pointer.ahistoric),ephemeral:new Be(n.pointer.ephemeral)},this.pointers={historic:this._pointerProxies.historic.pointer,ahistoric:this._pointerProxies.ahistoric.pointer,ephemeral:this._pointerProxies.ephemeral.pointer},it.add(t,this),this._readyDeferred=ie(),r.state?setTimeout(()=>{this._studio||(this._readyDeferred.resolve(void 0),this._logger._trace("ready deferred resolved with no state"))},0):setTimeout(()=>{if(!this._studio)throw new Error(`Argument config.state in Theatre.getProject("${t}", config) is empty. This is fine while you are using @theatre/core along with @theatre/sutdio. But since @theatre/studio is not loaded, the state of project "${t}" will be empty.

To fix this, you need to add @theatre/studio into the bundle and export the projet's state. Learn how to do that at https://docs.theatrejs.com/in-depth/#exporting`)},1e3)}attachToStudio(t){if(this._studio){if(this._studio!==t)throw new Error(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`);this._logger.warnDev(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`);return}this._studio=t,t.initialized.then(async()=>{await $o(t,this,this.config.state),this._pointerProxies.historic.setPointer(t.atomP.historic.coreByProject[this.address.projectId]),this._pointerProxies.ahistoric.setPointer(t.atomP.ahistoric.coreByProject[this.address.projectId]),this._pointerProxies.ephemeral.setPointer(t.atomP.ephemeral.coreByProject[this.address.projectId]),this._readyDeferred.resolve(void 0)})}get isAttachedToStudio(){return!!this._studio}get ready(){return this._readyDeferred.promise}isReady(){return this._readyDeferred.status==="resolved"}getOrCreateSheet(t,r="default"){let o=this._sheetTemplates.getState()[t];return o||(o=new wr(this,t),this._sheetTemplates.setIn([t],o)),o.getInstance(r)}};var Nr=class{get type(){return"Theatre_Project_PublicAPI"}constructor(t,r={}){Ie(this,new Vr(t,r,this))}get ready(){return S(this).ready}get isReady(){return S(this).isReady()}get address(){return y({},S(this).address)}sheet(t,r="default"){let o=Tr(t,"project.sheet");return S(this).getOrCreateSheet(o,r).publicApi}};var kT=Rt(To());function cs(e,t={}){let r=it.get(e);if(r)return r.publicApi;let n=Rr(t.experiments).named("Project",e);return t.state?(am(e,t.state),n._debug("deep validated config.state on disk")):n._debug("no config.state"),new Nr(e,t)}var nm=(e,t)=>{if(Array.isArray(t)||t==null||t.definitionVersion!==vt.currentProjectStateDefinitionVersion)throw new Q(`Error validating conf.state in Theatre.getProject(${JSON.stringify(e)}, conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://docs.theatrejs.com`)},am=(e,t)=>{nm(e,t)};function ms(e,t){if(je(e))return $(e).tapImmediate(ce,t);if(oe(e))return e.tapImmediate(ce,t);throw new Error("Called onChange(p) where p is neither a pointer nor a derivation.")}function hs(e){if(je(e))return $(e).getValue();throw new Error("Called val(p) where p is not a pointer.")}var gs="__TheatreJS_StudioBundle",Lr="__TheatreJS_CoreBundle";var Mr=class{constructor(){d(this,"_studio")}get type(){return"Theatre_CoreBundle"}get version(){return"0.5.0-rc.1"}getBitsForStudio(t,r){if(this._studio)throw new Error("@theatre/core is already attached to @theatre/studio");this._studio=t;let o={projectsP:it.atom.pointer.projects,privateAPI:S,coreExports:zo};r(o)}};im();function im(){if(typeof window=="undefined")return;let e=window[Lr];if(typeof e!="undefined")throw typeof e=="object"&&e&&typeof e.version=="string"?new Error(`It seems that the module '@theatre/core' is loaded more than once. This could have two possible causes:
1. You might have two separate versions of theatre in node_modules.
2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.

Note that it **is okay** to import '@theatre/core' multiple times. But those imports should point to the same module.`):new Error(`The variable window.${Lr} seems to be already set by a module other than @theatre/core.`);let t=new Mr;window[Lr]=t;let r=window[gs];r&&r!==null&&r.type==="Theatre_StudioBundle"&&r.registerCoreBundle(t)}window.Theatre={core:Uo,get studio(){alert("Theatre.studio is only available in the core-and-studio.js bundle. You're using the core-only.min.js bundle.")}};})();
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
//# sourceMappingURL=core-only.min.js.map
